{-# LANGUAGE LambdaCase #-}
{-# LANGUAGE NamedFieldPuns #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE PatternSynonyms #-}
{-# LANGUAGE ViewPatterns #-}

-- | This module defines the grammar of TBNF grammars.
-- With this, any other TBNF grammar can be defined in its own file, and then
-- read in, parsed, and compiled.
--
-- See @docs/tbnf.tbnf@ in the source tarball for the definition and
-- documentation of TBNF grammars.
module Text.Tbnf.Bootstrap
  ( tbnf
  , grammar
  , clean
  , parseTbnf
  ) where

import Data.Char (chr)
import Data.List (partition,uncons)
import Data.String (fromString)
import Data.Texpr (Texpr(..),Texprs)
import Data.Text (Text)
import Text.Location (Position(..),Range(..),FwdRange,toFwd,fromFwd)
import Text.Tbnf (compile,CompiledTbnf,RuleName,ParamName)
import Text.Tbnf (Tbnf(..),Rule(..),SatClass(..),CharClass(..))

import qualified Data.Text as T

------ Generated Base Grammar  ------

-- | A compiled form of 'tbnf'.
grammar :: CompiledTbnf
grammar = case compile tbnf of
  Right g -> g
  Left e -> errorWithoutStackTrace $ "internal Tbnf error: " ++ show e

pattern Fwd :: Range -> FwdRange
pattern Fwd r <- (fromFwd -> r)
  where
  Fwd = toFwd

-- | Define the grammar of TBNF, a grammar for defining texpr-generating grammars.
tbnf :: Tbnf
tbnf = Tbnf {start = Nothing, rules = [(Fwd (Range {anchor = Pos {nChars = 1496, line = 31, col = 3}, position = Pos {nChars = 1525, line = 31, col = 32}}),(Fwd (Range {anchor = Pos {nChars = 1496, line = 31, col = 3}, position = Pos {nChars = 1504, line = 31, col = 11}}),"birdFoot",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 1507, line = 31, col = 14}, position = Pos {nChars = 1516, line = 31, col = 23}})) "bird-foot" (Seq (Fwd (Range {anchor = Pos {nChars = 1518, line = 31, col = 25}, position = Pos {nChars = 1525, line = 31, col = 32}})) [Char (Fwd (Range {anchor = Pos {nChars = 1518, line = 31, col = 25}, position = Pos {nChars = 1521, line = 31, col = 28}})) '>',Char (Fwd (Range {anchor = Pos {nChars = 1522, line = 31, col = 29}, position = Pos {nChars = 1525, line = 31, col = 32}})) ' '])),(Fwd (Range {anchor = Pos {nChars = 1528, line = 32, col = 3}, position = Pos {nChars = 1666, line = 35, col = 6}}),(Fwd (Range {anchor = Pos {nChars = 1528, line = 32, col = 3}, position = Pos {nChars = 1536, line = 32, col = 11}}),"doc.line",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 1539, line = 32, col = 14}, position = Pos {nChars = 1542, line = 32, col = 17}})) "doc" (Flat (Fwd (Range {anchor = Pos {nChars = 1548, line = 33, col = 5}, position = Pos {nChars = 1666, line = 35, col = 6}})) (Seq (Fwd (Range {anchor = Pos {nChars = 1550, line = 33, col = 7}, position = Pos {nChars = 1624, line = 34, col = 18}})) [SatNeg (Fwd (Range {anchor = Pos {nChars = 1550, line = 33, col = 7}, position = Pos {nChars = 1560, line = 33, col = 17}})) [SatSet (Fwd (Range {anchor = Pos {nChars = 1553, line = 33, col = 10}, position = Pos {nChars = 1554, line = 33, col = 11}})) ">",SatChar (Fwd (Range {anchor = Pos {nChars = 1554, line = 33, col = 11}, position = Pos {nChars = 1558, line = 33, col = 15}})) '\n'],Rep (Fwd (Range {anchor = Pos {nChars = 1613, line = 34, col = 7}, position = Pos {nChars = 1624, line = 34, col = 18}})) (SatNeg (Fwd (Range {anchor = Pos {nChars = 1613, line = 34, col = 7}, position = Pos {nChars = 1623, line = 34, col = 17}})) [SatChar (Fwd (Range {anchor = Pos {nChars = 1616, line = 34, col = 10}, position = Pos {nChars = 1620, line = 34, col = 14}})) '\n']) (0,Nothing)]))),(Fwd (Range {anchor = Pos {nChars = 1671, line = 37, col = 3}, position = Pos {nChars = 1697, line = 37, col = 29}}),(Fwd (Range {anchor = Pos {nChars = 1671, line = 37, col = 3}, position = Pos {nChars = 1674, line = 37, col = 6}}),"Doc",[]),Rep (Fwd (Range {anchor = Pos {nChars = 1677, line = 37, col = 9}, position = Pos {nChars = 1697, line = 37, col = 29}})) (Alt (Fwd (Range {anchor = Pos {nChars = 1678, line = 37, col = 10}, position = Pos {nChars = 1695, line = 37, col = 27}})) [Seq (Fwd (Range {anchor = Pos {nChars = 1678, line = 37, col = 10}, position = Pos {nChars = 1690, line = 37, col = 22}})) [Call (Fwd (Range {anchor = Pos {nChars = 1678, line = 37, col = 10}, position = Pos {nChars = 1686, line = 37, col = 18}})) "doc.line" [],Rep (Fwd (Range {anchor = Pos {nChars = 1687, line = 37, col = 19}, position = Pos {nChars = 1690, line = 37, col = 22}})) (Call (Fwd (Range {anchor = Pos {nChars = 1687, line = 37, col = 19}, position = Pos {nChars = 1689, line = 37, col = 21}})) "nl" []) (0,Just 1)],Call (Fwd (Range {anchor = Pos {nChars = 1693, line = 37, col = 25}, position = Pos {nChars = 1695, line = 37, col = 27}})) "nl" []]) (1,Nothing)),(Fwd (Range {anchor = Pos {nChars = 2157, line = 45, col = 3}, position = Pos {nChars = 2171, line = 45, col = 17}}),(Fwd (Range {anchor = Pos {nChars = 2157, line = 45, col = 3}, position = Pos {nChars = 2162, line = 45, col = 8}}),"start",[]),Seq (Fwd (Range {anchor = Pos {nChars = 2165, line = 45, col = 11}, position = Pos {nChars = 2171, line = 45, col = 17}})) [Rep (Fwd (Range {anchor = Pos {nChars = 2165, line = 45, col = 11}, position = Pos {nChars = 2169, line = 45, col = 15}})) (Call (Fwd (Range {anchor = Pos {nChars = 2165, line = 45, col = 11}, position = Pos {nChars = 2168, line = 45, col = 14}})) "top" []) (0,Nothing),End (Fwd (Range {anchor = Pos {nChars = 2170, line = 45, col = 16}, position = Pos {nChars = 2171, line = 45, col = 17}}))]),(Fwd (Range {anchor = Pos {nChars = 2176, line = 47, col = 3}, position = Pos {nChars = 2232, line = 50, col = 10}}),(Fwd (Range {anchor = Pos {nChars = 2176, line = 47, col = 3}, position = Pos {nChars = 2179, line = 47, col = 6}}),"top",[]),Alt (Fwd (Range {anchor = Pos {nChars = 2186, line = 48, col = 7}, position = Pos {nChars = 2232, line = 50, col = 10}})) [Call (Fwd (Range {anchor = Pos {nChars = 2186, line = 48, col = 7}, position = Pos {nChars = 2189, line = 48, col = 10}})) "Doc" [],Seq (Fwd (Range {anchor = Pos {nChars = 2196, line = 49, col = 7}, position = Pos {nChars = 2222, line = 49, col = 33}})) [Call (Fwd (Range {anchor = Pos {nChars = 2196, line = 49, col = 7}, position = Pos {nChars = 2204, line = 49, col = 15}})) "birdFoot" [],Call (Fwd (Range {anchor = Pos {nChars = 2205, line = 49, col = 16}, position = Pos {nChars = 2208, line = 49, col = 19}})) "Def" [],Rep (Fwd (Range {anchor = Pos {nChars = 2209, line = 49, col = 20}, position = Pos {nChars = 2213, line = 49, col = 24}})) (Call (Fwd (Range {anchor = Pos {nChars = 2209, line = 49, col = 20}, position = Pos {nChars = 2212, line = 49, col = 23}})) "lws" []) (0,Nothing),Alt (Fwd (Range {anchor = Pos {nChars = 2215, line = 49, col = 26}, position = Pos {nChars = 2221, line = 49, col = 32}})) [Call (Fwd (Range {anchor = Pos {nChars = 2215, line = 49, col = 26}, position = Pos {nChars = 2217, line = 49, col = 28}})) "nl" [],End (Fwd (Range {anchor = Pos {nChars = 2220, line = 49, col = 31}, position = Pos {nChars = 2221, line = 49, col = 32}}))]],Call (Fwd (Range {anchor = Pos {nChars = 2229, line = 50, col = 7}, position = Pos {nChars = 2232, line = 50, col = 10}})) "vws" []]),(Fwd (Range {anchor = Pos {nChars = 2237, line = 52, col = 3}, position = Pos {nChars = 2250, line = 52, col = 16}}),(Fwd (Range {anchor = Pos {nChars = 2237, line = 52, col = 3}, position = Pos {nChars = 2239, line = 52, col = 5}}),"nl",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 2242, line = 52, col = 8}, position = Pos {nChars = 2244, line = 52, col = 10}})) "nl" (Char (Fwd (Range {anchor = Pos {nChars = 2246, line = 52, col = 12}, position = Pos {nChars = 2250, line = 52, col = 16}})) '\n')),(Fwd (Range {anchor = Pos {nChars = 2394, line = 57, col = 3}, position = Pos {nChars = 2415, line = 57, col = 24}}),(Fwd (Range {anchor = Pos {nChars = 2394, line = 57, col = 3}, position = Pos {nChars = 2399, line = 57, col = 8}}),"space",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 2402, line = 57, col = 11}, position = Pos {nChars = 2407, line = 57, col = 16}})) "space" (Flat (Fwd (Range {anchor = Pos {nChars = 2409, line = 57, col = 18}, position = Pos {nChars = 2415, line = 57, col = 24}})) (Rep (Fwd (Range {anchor = Pos {nChars = 2410, line = 57, col = 19}, position = Pos {nChars = 2414, line = 57, col = 23}})) (Char (Fwd (Range {anchor = Pos {nChars = 2410, line = 57, col = 19}, position = Pos {nChars = 2413, line = 57, col = 22}})) ' ') (1,Nothing)))),(Fwd (Range {anchor = Pos {nChars = 2418, line = 58, col = 3}, position = Pos {nChars = 2451, line = 58, col = 36}}),(Fwd (Range {anchor = Pos {nChars = 2418, line = 58, col = 3}, position = Pos {nChars = 2425, line = 58, col = 10}}),"comment",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 2428, line = 58, col = 13}, position = Pos {nChars = 2435, line = 58, col = 20}})) "comment" (Seq (Fwd (Range {anchor = Pos {nChars = 2437, line = 58, col = 22}, position = Pos {nChars = 2451, line = 58, col = 36}})) [Char (Fwd (Range {anchor = Pos {nChars = 2437, line = 58, col = 22}, position = Pos {nChars = 2440, line = 58, col = 25}})) '#',Flat (Fwd (Range {anchor = Pos {nChars = 2441, line = 58, col = 26}, position = Pos {nChars = 2451, line = 58, col = 36}})) (Rep (Fwd (Range {anchor = Pos {nChars = 2442, line = 58, col = 27}, position = Pos {nChars = 2450, line = 58, col = 35}})) (SatNeg (Fwd (Range {anchor = Pos {nChars = 2442, line = 58, col = 27}, position = Pos {nChars = 2449, line = 58, col = 34}})) [SatChar (Fwd (Range {anchor = Pos {nChars = 2444, line = 58, col = 29}, position = Pos {nChars = 2448, line = 58, col = 33}})) '\n']) (0,Nothing))])),(Fwd (Range {anchor = Pos {nChars = 2934, line = 65, col = 3}, position = Pos {nChars = 2973, line = 65, col = 42}}),(Fwd (Range {anchor = Pos {nChars = 2934, line = 65, col = 3}, position = Pos {nChars = 2951, line = 65, col = 20}}),"birdFoot.improper",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 2954, line = 65, col = 23}, position = Pos {nChars = 2963, line = 65, col = 32}})) "bird-foot" (Seq (Fwd (Range {anchor = Pos {nChars = 2965, line = 65, col = 34}, position = Pos {nChars = 2973, line = 65, col = 42}})) [Char (Fwd (Range {anchor = Pos {nChars = 2965, line = 65, col = 34}, position = Pos {nChars = 2968, line = 65, col = 37}})) '>',Char (Fwd (Range {anchor = Pos {nChars = 2969, line = 65, col = 38}, position = Pos {nChars = 2973, line = 65, col = 42}})) '\n'])),(Fwd (Range {anchor = Pos {nChars = 3391, line = 72, col = 3}, position = Pos {nChars = 3461, line = 74, col = 43}}),(Fwd (Range {anchor = Pos {nChars = 3391, line = 72, col = 3}, position = Pos {nChars = 3394, line = 72, col = 6}}),"lws",[]),Alt (Fwd (Range {anchor = Pos {nChars = 3397, line = 72, col = 9}, position = Pos {nChars = 3461, line = 74, col = 43}})) [Call (Fwd (Range {anchor = Pos {nChars = 3397, line = 72, col = 9}, position = Pos {nChars = 3402, line = 72, col = 14}})) "space" [],Call (Fwd (Range {anchor = Pos {nChars = 3411, line = 73, col = 9}, position = Pos {nChars = 3418, line = 73, col = 16}})) "comment" [],Seq (Fwd (Range {anchor = Pos {nChars = 3427, line = 74, col = 9}, position = Pos {nChars = 3461, line = 74, col = 43}})) [Call (Fwd (Range {anchor = Pos {nChars = 3427, line = 74, col = 9}, position = Pos {nChars = 3429, line = 74, col = 11}})) "nl" [],Rep (Fwd (Range {anchor = Pos {nChars = 3430, line = 74, col = 12}, position = Pos {nChars = 3448, line = 74, col = 30}})) (Call (Fwd (Range {anchor = Pos {nChars = 3430, line = 74, col = 12}, position = Pos {nChars = 3447, line = 74, col = 29}})) "birdFoot.improper" []) (0,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 3449, line = 74, col = 31}, position = Pos {nChars = 3457, line = 74, col = 39}})) "birdFoot" [],Call (Fwd (Range {anchor = Pos {nChars = 3458, line = 74, col = 40}, position = Pos {nChars = 3461, line = 74, col = 43}})) "lws" []]]),(Fwd (Range {anchor = Pos {nChars = 3564, line = 78, col = 3}, position = Pos {nChars = 3623, line = 79, col = 26}}),(Fwd (Range {anchor = Pos {nChars = 3564, line = 78, col = 3}, position = Pos {nChars = 3567, line = 78, col = 6}}),"vws",[]),Alt (Fwd (Range {anchor = Pos {nChars = 3570, line = 78, col = 9}, position = Pos {nChars = 3623, line = 79, col = 26}})) [Seq (Fwd (Range {anchor = Pos {nChars = 3570, line = 78, col = 9}, position = Pos {nChars = 3597, line = 78, col = 36}})) [Call (Fwd (Range {anchor = Pos {nChars = 3570, line = 78, col = 9}, position = Pos {nChars = 3578, line = 78, col = 17}})) "birdFoot" [],Rep (Fwd (Range {anchor = Pos {nChars = 3579, line = 78, col = 18}, position = Pos {nChars = 3585, line = 78, col = 24}})) (Call (Fwd (Range {anchor = Pos {nChars = 3579, line = 78, col = 18}, position = Pos {nChars = 3584, line = 78, col = 23}})) "space" []) (0,Nothing),Rep (Fwd (Range {anchor = Pos {nChars = 3586, line = 78, col = 25}, position = Pos {nChars = 3594, line = 78, col = 33}})) (Call (Fwd (Range {anchor = Pos {nChars = 3586, line = 78, col = 25}, position = Pos {nChars = 3593, line = 78, col = 32}})) "comment" []) (0,Just 1),Call (Fwd (Range {anchor = Pos {nChars = 3595, line = 78, col = 34}, position = Pos {nChars = 3597, line = 78, col = 36}})) "nl" []],Call (Fwd (Range {anchor = Pos {nChars = 3606, line = 79, col = 9}, position = Pos {nChars = 3623, line = 79, col = 26}})) "birdFoot.improper" []]),(Fwd (Range {anchor = Pos {nChars = 3893, line = 87, col = 3}, position = Pos {nChars = 3948, line = 87, col = 58}}),(Fwd (Range {anchor = Pos {nChars = 3893, line = 87, col = 3}, position = Pos {nChars = 3902, line = 87, col = 12}}),"Def.Start",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 3905, line = 87, col = 15}, position = Pos {nChars = 3914, line = 87, col = 24}})) "def-start" (Seq (Fwd (Range {anchor = Pos {nChars = 3916, line = 87, col = 26}, position = Pos {nChars = 3948, line = 87, col = 58}})) [Str (Fwd (Range {anchor = Pos {nChars = 3916, line = 87, col = 26}, position = Pos {nChars = 3924, line = 87, col = 34}})) "@start",Rep (Fwd (Range {anchor = Pos {nChars = 3925, line = 87, col = 35}, position = Pos {nChars = 3929, line = 87, col = 39}})) (Call (Fwd (Range {anchor = Pos {nChars = 3925, line = 87, col = 35}, position = Pos {nChars = 3928, line = 87, col = 38}})) "lws" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 3930, line = 87, col = 40}, position = Pos {nChars = 3933, line = 87, col = 43}})) '=',Rep (Fwd (Range {anchor = Pos {nChars = 3934, line = 87, col = 44}, position = Pos {nChars = 3938, line = 87, col = 48}})) (Call (Fwd (Range {anchor = Pos {nChars = 3934, line = 87, col = 44}, position = Pos {nChars = 3937, line = 87, col = 47}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 3939, line = 87, col = 49}, position = Pos {nChars = 3948, line = 87, col = 58}})) "Name.rule" []])),(Fwd (Range {anchor = Pos {nChars = 4171, line = 93, col = 3}, position = Pos {nChars = 4233, line = 93, col = 65}}),(Fwd (Range {anchor = Pos {nChars = 4171, line = 93, col = 3}, position = Pos {nChars = 4179, line = 93, col = 11}}),"Def.Rule",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 4182, line = 93, col = 14}, position = Pos {nChars = 4190, line = 93, col = 22}})) "def-rule" (Seq (Fwd (Range {anchor = Pos {nChars = 4192, line = 93, col = 24}, position = Pos {nChars = 4233, line = 93, col = 65}})) [Call (Fwd (Range {anchor = Pos {nChars = 4192, line = 93, col = 24}, position = Pos {nChars = 4204, line = 93, col = 36}})) "Def.Rule.lhs" [],Rep (Fwd (Range {anchor = Pos {nChars = 4205, line = 93, col = 37}, position = Pos {nChars = 4209, line = 93, col = 41}})) (Call (Fwd (Range {anchor = Pos {nChars = 4205, line = 93, col = 37}, position = Pos {nChars = 4208, line = 93, col = 40}})) "lws" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 4210, line = 93, col = 42}, position = Pos {nChars = 4213, line = 93, col = 45}})) '=',Rep (Fwd (Range {anchor = Pos {nChars = 4214, line = 93, col = 46}, position = Pos {nChars = 4218, line = 93, col = 50}})) (Call (Fwd (Range {anchor = Pos {nChars = 4214, line = 93, col = 46}, position = Pos {nChars = 4217, line = 93, col = 49}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 4219, line = 93, col = 51}, position = Pos {nChars = 4233, line = 93, col = 65}})) "Rule.allowFlat" []])),(Fwd (Range {anchor = Pos {nChars = 4238, line = 95, col = 3}, position = Pos {nChars = 4362, line = 97, col = 27}}),(Fwd (Range {anchor = Pos {nChars = 4238, line = 95, col = 3}, position = Pos {nChars = 4250, line = 95, col = 15}}),"Def.Rule.lhs",[]),Alt (Fwd (Range {anchor = Pos {nChars = 4253, line = 95, col = 18}, position = Pos {nChars = 4362, line = 97, col = 27}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 4253, line = 95, col = 18}, position = Pos {nChars = 4268, line = 95, col = 33}})) "rule-parametric" (Seq (Fwd (Range {anchor = Pos {nChars = 4288, line = 96, col = 19}, position = Pos {nChars = 4335, line = 96, col = 66}})) [Call (Fwd (Range {anchor = Pos {nChars = 4288, line = 96, col = 19}, position = Pos {nChars = 4297, line = 96, col = 28}})) "Name.rule" [],Call (Fwd (Range {anchor = Pos {nChars = 4298, line = 96, col = 29}, position = Pos {nChars = 4335, line = 96, col = 66}})) "enclose.angles" [Call (Fwd (Range {anchor = Pos {nChars = 4313, line = 96, col = 44}, position = Pos {nChars = 4334, line = 96, col = 65}})) "sep.comma" [Call (Fwd (Range {anchor = Pos {nChars = 4323, line = 96, col = 54}, position = Pos {nChars = 4333, line = 96, col = 64}})) "Name.param" []]]]),Call (Fwd (Range {anchor = Pos {nChars = 4353, line = 97, col = 18}, position = Pos {nChars = 4362, line = 97, col = 27}})) "Name.rule" []]),(Fwd (Range {anchor = Pos {nChars = 4574, line = 102, col = 3}, position = Pos {nChars = 4642, line = 102, col = 71}}),(Fwd (Range {anchor = Pos {nChars = 4574, line = 102, col = 3}, position = Pos {nChars = 4583, line = 102, col = 12}}),"Def.Class",[]),Ctor (Fwd (Range {anchor = Pos {nChars = 4586, line = 102, col = 15}, position = Pos {nChars = 4595, line = 102, col = 24}})) "def-class" (Seq (Fwd (Range {anchor = Pos {nChars = 4597, line = 102, col = 26}, position = Pos {nChars = 4642, line = 102, col = 71}})) [Call (Fwd (Range {anchor = Pos {nChars = 4597, line = 102, col = 26}, position = Pos {nChars = 4622, line = 102, col = 51}})) "enclose.colon" [Call (Fwd (Range {anchor = Pos {nChars = 4611, line = 102, col = 40}, position = Pos {nChars = 4621, line = 102, col = 50}})) "Name.class" []],Rep (Fwd (Range {anchor = Pos {nChars = 4623, line = 102, col = 52}, position = Pos {nChars = 4627, line = 102, col = 56}})) (Call (Fwd (Range {anchor = Pos {nChars = 4623, line = 102, col = 52}, position = Pos {nChars = 4626, line = 102, col = 55}})) "lws" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 4628, line = 102, col = 57}, position = Pos {nChars = 4631, line = 102, col = 60}})) '=',Rep (Fwd (Range {anchor = Pos {nChars = 4632, line = 102, col = 61}, position = Pos {nChars = 4636, line = 102, col = 65}})) (Call (Fwd (Range {anchor = Pos {nChars = 4632, line = 102, col = 61}, position = Pos {nChars = 4635, line = 102, col = 64}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 4637, line = 102, col = 66}, position = Pos {nChars = 4642, line = 102, col = 71}})) "Class" []])),(Fwd (Range {anchor = Pos {nChars = 4715, line = 106, col = 3}, position = Pos {nChars = 4753, line = 106, col = 41}}),(Fwd (Range {anchor = Pos {nChars = 4715, line = 106, col = 3}, position = Pos {nChars = 4718, line = 106, col = 6}}),"Def",[]),Alt (Fwd (Range {anchor = Pos {nChars = 4721, line = 106, col = 9}, position = Pos {nChars = 4753, line = 106, col = 41}})) [Call (Fwd (Range {anchor = Pos {nChars = 4721, line = 106, col = 9}, position = Pos {nChars = 4730, line = 106, col = 18}})) "Def.Start" [],Call (Fwd (Range {anchor = Pos {nChars = 4733, line = 106, col = 21}, position = Pos {nChars = 4742, line = 106, col = 30}})) "Def.Class" [],Call (Fwd (Range {anchor = Pos {nChars = 4745, line = 106, col = 33}, position = Pos {nChars = 4753, line = 106, col = 41}})) "Def.Rule" []]),(Fwd (Range {anchor = Pos {nChars = 6290, line = 132, col = 3}, position = Pos {nChars = 6492, line = 137, col = 47}}),(Fwd (Range {anchor = Pos {nChars = 6290, line = 132, col = 3}, position = Pos {nChars = 6299, line = 132, col = 12}}),"Rule.prim",[]),Alt (Fwd (Range {anchor = Pos {nChars = 6306, line = 133, col = 7}, position = Pos {nChars = 6492, line = 137, col = 47}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 6306, line = 133, col = 7}, position = Pos {nChars = 6315, line = 133, col = 16}})) "rule-char" (Seq (Fwd (Range {anchor = Pos {nChars = 6317, line = 133, col = 18}, position = Pos {nChars = 6334, line = 133, col = 35}})) [Char (Fwd (Range {anchor = Pos {nChars = 6317, line = 133, col = 18}, position = Pos {nChars = 6321, line = 133, col = 22}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 6322, line = 133, col = 23}, position = Pos {nChars = 6329, line = 133, col = 30}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 6330, line = 133, col = 31}, position = Pos {nChars = 6334, line = 133, col = 35}})) '\'']),Ctor (Fwd (Range {anchor = Pos {nChars = 6341, line = 134, col = 7}, position = Pos {nChars = 6349, line = 134, col = 15}})) "rule-sat" (Seq (Fwd (Range {anchor = Pos {nChars = 6351, line = 134, col = 17}, position = Pos {nChars = 6386, line = 134, col = 52}})) [Alt (Fwd (Range {anchor = Pos {nChars = 6352, line = 134, col = 18}, position = Pos {nChars = 6362, line = 134, col = 28}})) [Str (Fwd (Range {anchor = Pos {nChars = 6352, line = 134, col = 18}, position = Pos {nChars = 6356, line = 134, col = 22}})) "[^",Char (Fwd (Range {anchor = Pos {nChars = 6359, line = 134, col = 25}, position = Pos {nChars = 6362, line = 134, col = 28}})) '['],Rep (Fwd (Range {anchor = Pos {nChars = 6364, line = 134, col = 30}, position = Pos {nChars = 6382, line = 134, col = 48}})) (Call (Fwd (Range {anchor = Pos {nChars = 6364, line = 134, col = 30}, position = Pos {nChars = 6381, line = 134, col = 47}})) "Rule.satisfy.part" []) (0,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 6383, line = 134, col = 49}, position = Pos {nChars = 6386, line = 134, col = 52}})) ']']),Ctor (Fwd (Range {anchor = Pos {nChars = 6393, line = 135, col = 7}, position = Pos {nChars = 6404, line = 135, col = 18}})) "rule-string" (Seq (Fwd (Range {anchor = Pos {nChars = 6406, line = 135, col = 20}, position = Pos {nChars = 6425, line = 135, col = 39}})) [Char (Fwd (Range {anchor = Pos {nChars = 6406, line = 135, col = 20}, position = Pos {nChars = 6410, line = 135, col = 24}})) '"',Rep (Fwd (Range {anchor = Pos {nChars = 6411, line = 135, col = 25}, position = Pos {nChars = 6420, line = 135, col = 34}})) (Call (Fwd (Range {anchor = Pos {nChars = 6411, line = 135, col = 25}, position = Pos {nChars = 6419, line = 135, col = 33}})) "chars.dq" []) (0,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 6421, line = 135, col = 35}, position = Pos {nChars = 6425, line = 135, col = 39}})) '"']),Ctor (Fwd (Range {anchor = Pos {nChars = 6432, line = 136, col = 7}, position = Pos {nChars = 6440, line = 136, col = 15}})) "rule-end" (Char (Fwd (Range {anchor = Pos {nChars = 6442, line = 136, col = 17}, position = Pos {nChars = 6445, line = 136, col = 20}})) '$'),Ctor (Fwd (Range {anchor = Pos {nChars = 6452, line = 137, col = 7}, position = Pos {nChars = 6461, line = 137, col = 16}})) "rule-void" (Seq (Fwd (Range {anchor = Pos {nChars = 6463, line = 137, col = 18}, position = Pos {nChars = 6492, line = 137, col = 47}})) [Char (Fwd (Range {anchor = Pos {nChars = 6463, line = 137, col = 18}, position = Pos {nChars = 6466, line = 137, col = 21}})) '0',Call (Fwd (Range {anchor = Pos {nChars = 6467, line = 137, col = 22}, position = Pos {nChars = 6472, line = 137, col = 27}})) "colon" [],Char (Fwd (Range {anchor = Pos {nChars = 6473, line = 137, col = 28}, position = Pos {nChars = 6477, line = 137, col = 32}})) '"',Rep (Fwd (Range {anchor = Pos {nChars = 6478, line = 137, col = 33}, position = Pos {nChars = 6487, line = 137, col = 42}})) (Call (Fwd (Range {anchor = Pos {nChars = 6478, line = 137, col = 33}, position = Pos {nChars = 6486, line = 137, col = 41}})) "chars.dq" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 6488, line = 137, col = 43}, position = Pos {nChars = 6492, line = 137, col = 47}})) '"'])]),(Fwd (Range {anchor = Pos {nChars = 6916, line = 146, col = 3}, position = Pos {nChars = 7102, line = 151, col = 10}}),(Fwd (Range {anchor = Pos {nChars = 6916, line = 146, col = 3}, position = Pos {nChars = 6933, line = 146, col = 20}}),"Rule.satisfy.part",[]),Alt (Fwd (Range {anchor = Pos {nChars = 6940, line = 147, col = 7}, position = Pos {nChars = 7102, line = 151, col = 10}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 6940, line = 147, col = 7}, position = Pos {nChars = 6949, line = 147, col = 16}})) "sat-range" (Seq (Fwd (Range {anchor = Pos {nChars = 6951, line = 147, col = 18}, position = Pos {nChars = 6991, line = 147, col = 58}})) [Char (Fwd (Range {anchor = Pos {nChars = 6951, line = 147, col = 18}, position = Pos {nChars = 6955, line = 147, col = 22}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 6956, line = 147, col = 23}, position = Pos {nChars = 6963, line = 147, col = 30}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 6964, line = 147, col = 31}, position = Pos {nChars = 6968, line = 147, col = 35}})) '\'',Str (Fwd (Range {anchor = Pos {nChars = 6969, line = 147, col = 36}, position = Pos {nChars = 6973, line = 147, col = 40}})) "..",Char (Fwd (Range {anchor = Pos {nChars = 6974, line = 147, col = 41}, position = Pos {nChars = 6978, line = 147, col = 45}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 6979, line = 147, col = 46}, position = Pos {nChars = 6986, line = 147, col = 53}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 6987, line = 147, col = 54}, position = Pos {nChars = 6991, line = 147, col = 58}})) '\'']),Ctor (Fwd (Range {anchor = Pos {nChars = 6998, line = 148, col = 7}, position = Pos {nChars = 7006, line = 148, col = 15}})) "sat-char" (Seq (Fwd (Range {anchor = Pos {nChars = 7008, line = 148, col = 17}, position = Pos {nChars = 7025, line = 148, col = 34}})) [Char (Fwd (Range {anchor = Pos {nChars = 7008, line = 148, col = 17}, position = Pos {nChars = 7012, line = 148, col = 21}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 7013, line = 148, col = 22}, position = Pos {nChars = 7020, line = 148, col = 29}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 7021, line = 148, col = 30}, position = Pos {nChars = 7025, line = 148, col = 34}})) '\'']),Ctor (Fwd (Range {anchor = Pos {nChars = 7032, line = 149, col = 7}, position = Pos {nChars = 7039, line = 149, col = 14}})) "sat-var" (Call (Fwd (Range {anchor = Pos {nChars = 7041, line = 149, col = 16}, position = Pos {nChars = 7066, line = 149, col = 41}})) "enclose.colon" [Call (Fwd (Range {anchor = Pos {nChars = 7055, line = 149, col = 30}, position = Pos {nChars = 7065, line = 149, col = 40}})) "Name.class" []]),Flat (Fwd (Range {anchor = Pos {nChars = 7073, line = 150, col = 7}, position = Pos {nChars = 7092, line = 150, col = 26}})) (Rep (Fwd (Range {anchor = Pos {nChars = 7075, line = 150, col = 9}, position = Pos {nChars = 7090, line = 150, col = 24}})) (Sat (Fwd (Range {anchor = Pos {nChars = 7075, line = 150, col = 9}, position = Pos {nChars = 7089, line = 150, col = 23}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 7076, line = 150, col = 10}, position = Pos {nChars = 7088, line = 150, col = 22}})) "char.brack"]) (1,Nothing)),Call (Fwd (Range {anchor = Pos {nChars = 7099, line = 151, col = 7}, position = Pos {nChars = 7102, line = 151, col = 10}})) "lws" []]),(Fwd (Range {anchor = Pos {nChars = 7648, line = 161, col = 3}, position = Pos {nChars = 7858, line = 166, col = 16}}),(Fwd (Range {anchor = Pos {nChars = 7648, line = 161, col = 3}, position = Pos {nChars = 7660, line = 161, col = 15}}),"Rule.Atom",["f"]),Alt (Fwd (Range {anchor = Pos {nChars = 7667, line = 162, col = 7}, position = Pos {nChars = 7858, line = 166, col = 16}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 7667, line = 162, col = 7}, position = Pos {nChars = 7677, line = 162, col = 17}})) "rule-group" (Call (Fwd (Range {anchor = Pos {nChars = 7679, line = 162, col = 19}, position = Pos {nChars = 7709, line = 162, col = 49}})) "enclose.parens" [Call (Fwd (Range {anchor = Pos {nChars = 7694, line = 162, col = 34}, position = Pos {nChars = 7708, line = 162, col = 48}})) "Rule.allowFlat" []]),Ctor (Fwd (Range {anchor = Pos {nChars = 7716, line = 163, col = 7}, position = Pos {nChars = 7725, line = 163, col = 16}})) "rule-call" (Seq (Fwd (Range {anchor = Pos {nChars = 7727, line = 163, col = 18}, position = Pos {nChars = 7779, line = 163, col = 70}})) [Call (Fwd (Range {anchor = Pos {nChars = 7727, line = 163, col = 18}, position = Pos {nChars = 7736, line = 163, col = 27}})) "Name.rule" [],Rep (Fwd (Range {anchor = Pos {nChars = 7737, line = 163, col = 28}, position = Pos {nChars = 7779, line = 163, col = 70}})) (Call (Fwd (Range {anchor = Pos {nChars = 7737, line = 163, col = 28}, position = Pos {nChars = 7778, line = 163, col = 69}})) "enclose.angles" [Call (Fwd (Range {anchor = Pos {nChars = 7752, line = 163, col = 43}, position = Pos {nChars = 7777, line = 163, col = 68}})) "sep.comma" [Call (Fwd (Range {anchor = Pos {nChars = 7762, line = 163, col = 53}, position = Pos {nChars = 7776, line = 163, col = 67}})) "Rule.allowFlat" []]]) (0,Just 1)]),Ctor (Fwd (Range {anchor = Pos {nChars = 7786, line = 164, col = 7}, position = Pos {nChars = 7795, line = 164, col = 16}})) "rule-flat" (Call (Fwd (Range {anchor = Pos {nChars = 7797, line = 164, col = 18}, position = Pos {nChars = 7798, line = 164, col = 19}})) "f" []),Ctor (Fwd (Range {anchor = Pos {nChars = 7805, line = 165, col = 7}, position = Pos {nChars = 7815, line = 165, col = 17}})) "rule-combo" (Call (Fwd (Range {anchor = Pos {nChars = 7817, line = 165, col = 19}, position = Pos {nChars = 7842, line = 165, col = 44}})) "enclose.braces" [Call (Fwd (Range {anchor = Pos {nChars = 7832, line = 165, col = 34}, position = Pos {nChars = 7841, line = 165, col = 43}})) "Name.ctor" []]),Call (Fwd (Range {anchor = Pos {nChars = 7849, line = 166, col = 7}, position = Pos {nChars = 7858, line = 166, col = 16}})) "Rule.prim" []]),(Fwd (Range {anchor = Pos {nChars = 7863, line = 168, col = 3}, position = Pos {nChars = 7911, line = 168, col = 51}}),(Fwd (Range {anchor = Pos {nChars = 7863, line = 168, col = 3}, position = Pos {nChars = 7872, line = 168, col = 12}}),"Rule.Flat",[]),Call (Fwd (Range {anchor = Pos {nChars = 7875, line = 168, col = 15}, position = Pos {nChars = 7911, line = 168, col = 51}})) "enclose" [Char (Fwd (Range {anchor = Pos {nChars = 7883, line = 168, col = 23}, position = Pos {nChars = 7886, line = 168, col = 26}})) '/',Call (Fwd (Range {anchor = Pos {nChars = 7888, line = 168, col = 28}, position = Pos {nChars = 7905, line = 168, col = 45}})) "Rule.disallowFlat" [],Char (Fwd (Range {anchor = Pos {nChars = 7907, line = 168, col = 47}, position = Pos {nChars = 7910, line = 168, col = 50}})) '/']),(Fwd (Range {anchor = Pos {nChars = 8602, line = 181, col = 3}, position = Pos {nChars = 8634, line = 181, col = 35}}),(Fwd (Range {anchor = Pos {nChars = 8602, line = 181, col = 3}, position = Pos {nChars = 8616, line = 181, col = 17}}),"Rule.allowFlat",[]),Call (Fwd (Range {anchor = Pos {nChars = 8619, line = 181, col = 20}, position = Pos {nChars = 8634, line = 181, col = 35}})) "Rule" [Call (Fwd (Range {anchor = Pos {nChars = 8624, line = 181, col = 25}, position = Pos {nChars = 8633, line = 181, col = 34}})) "Rule.Flat" []]),(Fwd (Range {anchor = Pos {nChars = 8637, line = 182, col = 3}, position = Pos {nChars = 8689, line = 182, col = 55}}),(Fwd (Range {anchor = Pos {nChars = 8637, line = 182, col = 3}, position = Pos {nChars = 8654, line = 182, col = 20}}),"Rule.disallowFlat",[]),Call (Fwd (Range {anchor = Pos {nChars = 8657, line = 182, col = 23}, position = Pos {nChars = 8689, line = 182, col = 55}})) "Rule" [Void (Fwd (Range {anchor = Pos {nChars = 8662, line = 182, col = 28}, position = Pos {nChars = 8688, line = 182, col = 54}})) "flat rule inside flat"]),(Fwd (Range {anchor = Pos {nChars = 8847, line = 187, col = 3}, position = Pos {nChars = 8925, line = 189, col = 19}}),(Fwd (Range {anchor = Pos {nChars = 8847, line = 187, col = 3}, position = Pos {nChars = 8861, line = 187, col = 17}}),"Rule.Factor",["f"]),Alt (Fwd (Range {anchor = Pos {nChars = 8868, line = 188, col = 7}, position = Pos {nChars = 8925, line = 189, col = 19}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 8868, line = 188, col = 7}, position = Pos {nChars = 8876, line = 188, col = 15}})) "rule-rep" (Seq (Fwd (Range {anchor = Pos {nChars = 8878, line = 188, col = 17}, position = Pos {nChars = 8906, line = 188, col = 45}})) [Call (Fwd (Range {anchor = Pos {nChars = 8878, line = 188, col = 17}, position = Pos {nChars = 8890, line = 188, col = 29}})) "Rule.Atom" [Call (Fwd (Range {anchor = Pos {nChars = 8888, line = 188, col = 27}, position = Pos {nChars = 8889, line = 188, col = 28}})) "f" []],Call (Fwd (Range {anchor = Pos {nChars = 8891, line = 188, col = 30}, position = Pos {nChars = 8906, line = 188, col = 45}})) "Rule.Rep.amount" []]),Call (Fwd (Range {anchor = Pos {nChars = 8913, line = 189, col = 7}, position = Pos {nChars = 8925, line = 189, col = 19}})) "Rule.Atom" [Call (Fwd (Range {anchor = Pos {nChars = 8923, line = 189, col = 17}, position = Pos {nChars = 8924, line = 189, col = 18}})) "f" []]]),(Fwd (Range {anchor = Pos {nChars = 8930, line = 191, col = 3}, position = Pos {nChars = 9057, line = 194, col = 42}}),(Fwd (Range {anchor = Pos {nChars = 8930, line = 191, col = 3}, position = Pos {nChars = 8945, line = 191, col = 18}}),"Rule.Rep.amount",[]),Alt (Fwd (Range {anchor = Pos {nChars = 8952, line = 192, col = 7}, position = Pos {nChars = 9057, line = 194, col = 42}})) [Sat (Fwd (Range {anchor = Pos {nChars = 8952, line = 192, col = 7}, position = Pos {nChars = 8957, line = 192, col = 12}})) [SatSet (Fwd (Range {anchor = Pos {nChars = 8953, line = 192, col = 8}, position = Pos {nChars = 8956, line = 192, col = 11}})) "*+?"],Ctor (Fwd (Range {anchor = Pos {nChars = 8964, line = 193, col = 7}, position = Pos {nChars = 8974, line = 193, col = 17}})) "rep-custom" (Call (Fwd (Range {anchor = Pos {nChars = 8976, line = 193, col = 19}, position = Pos {nChars = 9015, line = 193, col = 58}})) "enclose.braces" [Seq (Fwd (Range {anchor = Pos {nChars = 8991, line = 193, col = 34}, position = Pos {nChars = 9014, line = 193, col = 57}})) [Rep (Fwd (Range {anchor = Pos {nChars = 8991, line = 193, col = 34}, position = Pos {nChars = 8999, line = 193, col = 42}})) (Call (Fwd (Range {anchor = Pos {nChars = 8991, line = 193, col = 34}, position = Pos {nChars = 8998, line = 193, col = 41}})) "num.nat" []) (0,Just 1),Call (Fwd (Range {anchor = Pos {nChars = 9000, line = 193, col = 43}, position = Pos {nChars = 9005, line = 193, col = 48}})) "comma" [],Rep (Fwd (Range {anchor = Pos {nChars = 9006, line = 193, col = 49}, position = Pos {nChars = 9014, line = 193, col = 57}})) (Call (Fwd (Range {anchor = Pos {nChars = 9006, line = 193, col = 49}, position = Pos {nChars = 9013, line = 193, col = 56}})) "num.nat" []) (0,Just 1)]]),Ctor (Fwd (Range {anchor = Pos {nChars = 9022, line = 194, col = 7}, position = Pos {nChars = 9032, line = 194, col = 17}})) "rep-custom" (Call (Fwd (Range {anchor = Pos {nChars = 9034, line = 194, col = 19}, position = Pos {nChars = 9057, line = 194, col = 42}})) "enclose.braces" [Call (Fwd (Range {anchor = Pos {nChars = 9049, line = 194, col = 34}, position = Pos {nChars = 9056, line = 194, col = 41}})) "num.nat" []])]),(Fwd (Range {anchor = Pos {nChars = 9414, line = 201, col = 3}, position = Pos {nChars = 9580, line = 204, col = 21}}),(Fwd (Range {anchor = Pos {nChars = 9414, line = 201, col = 3}, position = Pos {nChars = 9425, line = 201, col = 14}}),"Rule.Seq",["f"]),Alt (Fwd (Range {anchor = Pos {nChars = 9432, line = 202, col = 7}, position = Pos {nChars = 9580, line = 204, col = 21}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 9432, line = 202, col = 7}, position = Pos {nChars = 9444, line = 202, col = 19}})) "rule-capture" (Seq (Fwd (Range {anchor = Pos {nChars = 9446, line = 202, col = 21}, position = Pos {nChars = 9505, line = 202, col = 80}})) [Char (Fwd (Range {anchor = Pos {nChars = 9446, line = 202, col = 21}, position = Pos {nChars = 9449, line = 202, col = 24}})) '@',Call (Fwd (Range {anchor = Pos {nChars = 9450, line = 202, col = 25}, position = Pos {nChars = 9459, line = 202, col = 34}})) "Name.rule" [],Rep (Fwd (Range {anchor = Pos {nChars = 9460, line = 202, col = 35}, position = Pos {nChars = 9464, line = 202, col = 39}})) (Call (Fwd (Range {anchor = Pos {nChars = 9460, line = 202, col = 35}, position = Pos {nChars = 9463, line = 202, col = 38}})) "lws" []) (0,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 9465, line = 202, col = 40}, position = Pos {nChars = 9468, line = 202, col = 43}})) '=',Rep (Fwd (Range {anchor = Pos {nChars = 9469, line = 202, col = 44}, position = Pos {nChars = 9473, line = 202, col = 48}})) (Call (Fwd (Range {anchor = Pos {nChars = 9469, line = 202, col = 44}, position = Pos {nChars = 9472, line = 202, col = 47}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 9474, line = 202, col = 49}, position = Pos {nChars = 9488, line = 202, col = 63}})) "Rule.Factor" [Call (Fwd (Range {anchor = Pos {nChars = 9486, line = 202, col = 61}, position = Pos {nChars = 9487, line = 202, col = 62}})) "f" []],Rep (Fwd (Range {anchor = Pos {nChars = 9489, line = 202, col = 64}, position = Pos {nChars = 9493, line = 202, col = 68}})) (Call (Fwd (Range {anchor = Pos {nChars = 9489, line = 202, col = 64}, position = Pos {nChars = 9492, line = 202, col = 67}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 9494, line = 202, col = 69}, position = Pos {nChars = 9505, line = 202, col = 80}})) "Rule.Seq" [Call (Fwd (Range {anchor = Pos {nChars = 9503, line = 202, col = 78}, position = Pos {nChars = 9504, line = 202, col = 79}})) "f" []]]),Ctor (Fwd (Range {anchor = Pos {nChars = 9512, line = 203, col = 7}, position = Pos {nChars = 9520, line = 203, col = 15}})) "rule-seq" (Seq (Fwd (Range {anchor = Pos {nChars = 9522, line = 203, col = 17}, position = Pos {nChars = 9559, line = 203, col = 54}})) [Call (Fwd (Range {anchor = Pos {nChars = 9522, line = 203, col = 17}, position = Pos {nChars = 9536, line = 203, col = 31}})) "Rule.Factor" [Call (Fwd (Range {anchor = Pos {nChars = 9534, line = 203, col = 29}, position = Pos {nChars = 9535, line = 203, col = 30}})) "f" []],Rep (Fwd (Range {anchor = Pos {nChars = 9537, line = 203, col = 32}, position = Pos {nChars = 9559, line = 203, col = 54}})) (Seq (Fwd (Range {anchor = Pos {nChars = 9538, line = 203, col = 33}, position = Pos {nChars = 9557, line = 203, col = 52}})) [Rep (Fwd (Range {anchor = Pos {nChars = 9538, line = 203, col = 33}, position = Pos {nChars = 9542, line = 203, col = 37}})) (Call (Fwd (Range {anchor = Pos {nChars = 9538, line = 203, col = 33}, position = Pos {nChars = 9541, line = 203, col = 36}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 9543, line = 203, col = 38}, position = Pos {nChars = 9557, line = 203, col = 52}})) "Rule.Factor" [Call (Fwd (Range {anchor = Pos {nChars = 9555, line = 203, col = 50}, position = Pos {nChars = 9556, line = 203, col = 51}})) "f" []]]) (1,Nothing)]),Call (Fwd (Range {anchor = Pos {nChars = 9566, line = 204, col = 7}, position = Pos {nChars = 9580, line = 204, col = 21}})) "Rule.Factor" [Call (Fwd (Range {anchor = Pos {nChars = 9578, line = 204, col = 19}, position = Pos {nChars = 9579, line = 204, col = 20}})) "f" []]]),(Fwd (Range {anchor = Pos {nChars = 9656, line = 208, col = 3}, position = Pos {nChars = 9731, line = 210, col = 18}}),(Fwd (Range {anchor = Pos {nChars = 9656, line = 208, col = 3}, position = Pos {nChars = 9668, line = 208, col = 15}}),"Rule.Term",["f"]),Alt (Fwd (Range {anchor = Pos {nChars = 9675, line = 209, col = 7}, position = Pos {nChars = 9731, line = 210, col = 18}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 9675, line = 209, col = 7}, position = Pos {nChars = 9684, line = 209, col = 16}})) "rule-ctor" (Seq (Fwd (Range {anchor = Pos {nChars = 9686, line = 209, col = 18}, position = Pos {nChars = 9713, line = 209, col = 45}})) [Call (Fwd (Range {anchor = Pos {nChars = 9686, line = 209, col = 18}, position = Pos {nChars = 9695, line = 209, col = 27}})) "Name.ctor" [],Call (Fwd (Range {anchor = Pos {nChars = 9696, line = 209, col = 28}, position = Pos {nChars = 9701, line = 209, col = 33}})) "colon" [],Call (Fwd (Range {anchor = Pos {nChars = 9702, line = 209, col = 34}, position = Pos {nChars = 9713, line = 209, col = 45}})) "Rule.Seq" [Call (Fwd (Range {anchor = Pos {nChars = 9711, line = 209, col = 43}, position = Pos {nChars = 9712, line = 209, col = 44}})) "f" []]]),Call (Fwd (Range {anchor = Pos {nChars = 9720, line = 210, col = 7}, position = Pos {nChars = 9731, line = 210, col = 18}})) "Rule.Seq" [Call (Fwd (Range {anchor = Pos {nChars = 9729, line = 210, col = 16}, position = Pos {nChars = 9730, line = 210, col = 17}})) "f" []]]),(Fwd (Range {anchor = Pos {nChars = 9906, line = 215, col = 3}, position = Pos {nChars = 10004, line = 217, col = 19}}),(Fwd (Range {anchor = Pos {nChars = 9906, line = 215, col = 3}, position = Pos {nChars = 9920, line = 215, col = 17}}),"Rule.Expect",["f"]),Alt (Fwd (Range {anchor = Pos {nChars = 9927, line = 216, col = 7}, position = Pos {nChars = 10004, line = 217, col = 19}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 9927, line = 216, col = 7}, position = Pos {nChars = 9938, line = 216, col = 18}})) "rule-expect" (Seq (Fwd (Range {anchor = Pos {nChars = 9940, line = 216, col = 20}, position = Pos {nChars = 9985, line = 216, col = 65}})) [Call (Fwd (Range {anchor = Pos {nChars = 9940, line = 216, col = 20}, position = Pos {nChars = 9952, line = 216, col = 32}})) "Rule.Term" [Call (Fwd (Range {anchor = Pos {nChars = 9950, line = 216, col = 30}, position = Pos {nChars = 9951, line = 216, col = 31}})) "f" []],Rep (Fwd (Range {anchor = Pos {nChars = 9953, line = 216, col = 33}, position = Pos {nChars = 9957, line = 216, col = 37}})) (Call (Fwd (Range {anchor = Pos {nChars = 9953, line = 216, col = 33}, position = Pos {nChars = 9956, line = 216, col = 36}})) "lws" []) (1,Nothing),Str (Fwd (Range {anchor = Pos {nChars = 9958, line = 216, col = 38}, position = Pos {nChars = 9962, line = 216, col = 42}})) "??",Rep (Fwd (Range {anchor = Pos {nChars = 9963, line = 216, col = 43}, position = Pos {nChars = 9967, line = 216, col = 47}})) (Call (Fwd (Range {anchor = Pos {nChars = 9963, line = 216, col = 43}, position = Pos {nChars = 9966, line = 216, col = 46}})) "lws" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 9968, line = 216, col = 48}, position = Pos {nChars = 9971, line = 216, col = 51}})) '"',Rep (Fwd (Range {anchor = Pos {nChars = 9972, line = 216, col = 52}, position = Pos {nChars = 9981, line = 216, col = 61}})) (Call (Fwd (Range {anchor = Pos {nChars = 9972, line = 216, col = 52}, position = Pos {nChars = 9980, line = 216, col = 60}})) "chars.dq" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 9982, line = 216, col = 62}, position = Pos {nChars = 9985, line = 216, col = 65}})) '"']),Call (Fwd (Range {anchor = Pos {nChars = 9992, line = 217, col = 7}, position = Pos {nChars = 10004, line = 217, col = 19}})) "Rule.Term" [Call (Fwd (Range {anchor = Pos {nChars = 10002, line = 217, col = 17}, position = Pos {nChars = 10003, line = 217, col = 18}})) "f" []]]),(Fwd (Range {anchor = Pos {nChars = 10139, line = 222, col = 3}, position = Pos {nChars = 10230, line = 224, col = 21}}),(Fwd (Range {anchor = Pos {nChars = 10139, line = 222, col = 3}, position = Pos {nChars = 10146, line = 222, col = 10}}),"Rule",["f"]),Alt (Fwd (Range {anchor = Pos {nChars = 10153, line = 223, col = 7}, position = Pos {nChars = 10230, line = 224, col = 21}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 10153, line = 223, col = 7}, position = Pos {nChars = 10161, line = 223, col = 15}})) "rule-alt" (Seq (Fwd (Range {anchor = Pos {nChars = 10163, line = 223, col = 17}, position = Pos {nChars = 10209, line = 223, col = 63}})) [Call (Fwd (Range {anchor = Pos {nChars = 10163, line = 223, col = 17}, position = Pos {nChars = 10177, line = 223, col = 31}})) "Rule.Expect" [Call (Fwd (Range {anchor = Pos {nChars = 10175, line = 223, col = 29}, position = Pos {nChars = 10176, line = 223, col = 30}})) "f" []],Rep (Fwd (Range {anchor = Pos {nChars = 10178, line = 223, col = 32}, position = Pos {nChars = 10209, line = 223, col = 63}})) (Seq (Fwd (Range {anchor = Pos {nChars = 10179, line = 223, col = 33}, position = Pos {nChars = 10207, line = 223, col = 61}})) [Rep (Fwd (Range {anchor = Pos {nChars = 10179, line = 223, col = 33}, position = Pos {nChars = 10183, line = 223, col = 37}})) (Call (Fwd (Range {anchor = Pos {nChars = 10179, line = 223, col = 33}, position = Pos {nChars = 10182, line = 223, col = 36}})) "lws" []) (1,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 10184, line = 223, col = 38}, position = Pos {nChars = 10187, line = 223, col = 41}})) '|',Rep (Fwd (Range {anchor = Pos {nChars = 10188, line = 223, col = 42}, position = Pos {nChars = 10192, line = 223, col = 46}})) (Call (Fwd (Range {anchor = Pos {nChars = 10188, line = 223, col = 42}, position = Pos {nChars = 10191, line = 223, col = 45}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 10193, line = 223, col = 47}, position = Pos {nChars = 10207, line = 223, col = 61}})) "Rule.Expect" [Call (Fwd (Range {anchor = Pos {nChars = 10205, line = 223, col = 59}, position = Pos {nChars = 10206, line = 223, col = 60}})) "f" []]]) (1,Nothing)]),Call (Fwd (Range {anchor = Pos {nChars = 10216, line = 224, col = 7}, position = Pos {nChars = 10230, line = 224, col = 21}})) "Rule.Expect" [Call (Fwd (Range {anchor = Pos {nChars = 10228, line = 224, col = 19}, position = Pos {nChars = 10229, line = 224, col = 20}})) "f" []]]),(Fwd (Range {anchor = Pos {nChars = 10434, line = 232, col = 3}, position = Pos {nChars = 10491, line = 232, col = 60}}),(Fwd (Range {anchor = Pos {nChars = 10434, line = 232, col = 3}, position = Pos {nChars = 10439, line = 232, col = 8}}),"Class",[]),Seq (Fwd (Range {anchor = Pos {nChars = 10442, line = 232, col = 11}, position = Pos {nChars = 10491, line = 232, col = 60}})) [Call (Fwd (Range {anchor = Pos {nChars = 10442, line = 232, col = 11}, position = Pos {nChars = 10452, line = 232, col = 21}})) "Class.term" [],Rep (Fwd (Range {anchor = Pos {nChars = 10453, line = 232, col = 22}, position = Pos {nChars = 10491, line = 232, col = 60}})) (Seq (Fwd (Range {anchor = Pos {nChars = 10454, line = 232, col = 23}, position = Pos {nChars = 10489, line = 232, col = 58}})) [Rep (Fwd (Range {anchor = Pos {nChars = 10454, line = 232, col = 23}, position = Pos {nChars = 10458, line = 232, col = 27}})) (Call (Fwd (Range {anchor = Pos {nChars = 10454, line = 232, col = 23}, position = Pos {nChars = 10457, line = 232, col = 26}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 10459, line = 232, col = 28}, position = Pos {nChars = 10473, line = 232, col = 42}})) "Class.operator" [],Rep (Fwd (Range {anchor = Pos {nChars = 10474, line = 232, col = 43}, position = Pos {nChars = 10478, line = 232, col = 47}})) (Call (Fwd (Range {anchor = Pos {nChars = 10474, line = 232, col = 43}, position = Pos {nChars = 10477, line = 232, col = 46}})) "lws" []) (1,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 10479, line = 232, col = 48}, position = Pos {nChars = 10489, line = 232, col = 58}})) "Class.term" []]) (0,Nothing)]),(Fwd (Range {anchor = Pos {nChars = 10494, line = 233, col = 3}, position = Pos {nChars = 10520, line = 233, col = 29}}),(Fwd (Range {anchor = Pos {nChars = 10494, line = 233, col = 3}, position = Pos {nChars = 10508, line = 233, col = 17}}),"Class.operator",[]),Alt (Fwd (Range {anchor = Pos {nChars = 10511, line = 233, col = 20}, position = Pos {nChars = 10520, line = 233, col = 29}})) [Char (Fwd (Range {anchor = Pos {nChars = 10511, line = 233, col = 20}, position = Pos {nChars = 10514, line = 233, col = 23}})) '|',Char (Fwd (Range {anchor = Pos {nChars = 10517, line = 233, col = 26}, position = Pos {nChars = 10520, line = 233, col = 29}})) '-']),(Fwd (Range {anchor = Pos {nChars = 10778, line = 241, col = 3}, position = Pos {nChars = 10964, line = 245, col = 37}}),(Fwd (Range {anchor = Pos {nChars = 10778, line = 241, col = 3}, position = Pos {nChars = 10788, line = 241, col = 13}}),"Class.term",[]),Alt (Fwd (Range {anchor = Pos {nChars = 10795, line = 242, col = 7}, position = Pos {nChars = 10964, line = 245, col = 37}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 10795, line = 242, col = 7}, position = Pos {nChars = 10804, line = 242, col = 16}})) "class-var" (Call (Fwd (Range {anchor = Pos {nChars = 10806, line = 242, col = 18}, position = Pos {nChars = 10831, line = 242, col = 43}})) "enclose.colon" [Call (Fwd (Range {anchor = Pos {nChars = 10820, line = 242, col = 32}, position = Pos {nChars = 10830, line = 242, col = 42}})) "Name.class" []]),Ctor (Fwd (Range {anchor = Pos {nChars = 10838, line = 243, col = 7}, position = Pos {nChars = 10849, line = 243, col = 18}})) "class-range" (Seq (Fwd (Range {anchor = Pos {nChars = 10851, line = 243, col = 20}, position = Pos {nChars = 10891, line = 243, col = 60}})) [Char (Fwd (Range {anchor = Pos {nChars = 10851, line = 243, col = 20}, position = Pos {nChars = 10855, line = 243, col = 24}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 10856, line = 243, col = 25}, position = Pos {nChars = 10863, line = 243, col = 32}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 10864, line = 243, col = 33}, position = Pos {nChars = 10868, line = 243, col = 37}})) '\'',Str (Fwd (Range {anchor = Pos {nChars = 10869, line = 243, col = 38}, position = Pos {nChars = 10873, line = 243, col = 42}})) "..",Char (Fwd (Range {anchor = Pos {nChars = 10874, line = 243, col = 43}, position = Pos {nChars = 10878, line = 243, col = 47}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 10879, line = 243, col = 48}, position = Pos {nChars = 10886, line = 243, col = 55}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 10887, line = 243, col = 56}, position = Pos {nChars = 10891, line = 243, col = 60}})) '\'']),Ctor (Fwd (Range {anchor = Pos {nChars = 10898, line = 244, col = 7}, position = Pos {nChars = 10908, line = 244, col = 17}})) "class-char" (Seq (Fwd (Range {anchor = Pos {nChars = 10910, line = 244, col = 19}, position = Pos {nChars = 10927, line = 244, col = 36}})) [Char (Fwd (Range {anchor = Pos {nChars = 10910, line = 244, col = 19}, position = Pos {nChars = 10914, line = 244, col = 23}})) '\'',Call (Fwd (Range {anchor = Pos {nChars = 10915, line = 244, col = 24}, position = Pos {nChars = 10922, line = 244, col = 31}})) "char.sq" [],Char (Fwd (Range {anchor = Pos {nChars = 10923, line = 244, col = 32}, position = Pos {nChars = 10927, line = 244, col = 36}})) '\'']),Ctor (Fwd (Range {anchor = Pos {nChars = 10934, line = 245, col = 7}, position = Pos {nChars = 10943, line = 245, col = 16}})) "class-set" (Seq (Fwd (Range {anchor = Pos {nChars = 10945, line = 245, col = 18}, position = Pos {nChars = 10964, line = 245, col = 37}})) [Char (Fwd (Range {anchor = Pos {nChars = 10945, line = 245, col = 18}, position = Pos {nChars = 10949, line = 245, col = 22}})) '"',Rep (Fwd (Range {anchor = Pos {nChars = 10950, line = 245, col = 23}, position = Pos {nChars = 10959, line = 245, col = 32}})) (Call (Fwd (Range {anchor = Pos {nChars = 10950, line = 245, col = 23}, position = Pos {nChars = 10958, line = 245, col = 31}})) "chars.dq" []) (0,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 10960, line = 245, col = 33}, position = Pos {nChars = 10964, line = 245, col = 37}})) '"'])]),(Fwd (Range {anchor = Pos {nChars = 11458, line = 258, col = 3}, position = Pos {nChars = 11501, line = 260, col = 18}}),(Fwd (Range {anchor = Pos {nChars = 11458, line = 258, col = 3}, position = Pos {nChars = 11465, line = 258, col = 10}}),"char.sq",[]),Alt (Fwd (Range {anchor = Pos {nChars = 11472, line = 259, col = 7}, position = Pos {nChars = 11501, line = 260, col = 18}})) [Sat (Fwd (Range {anchor = Pos {nChars = 11472, line = 259, col = 7}, position = Pos {nChars = 11483, line = 259, col = 18}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 11473, line = 259, col = 8}, position = Pos {nChars = 11482, line = 259, col = 17}})) "char.sq"],Call (Fwd (Range {anchor = Pos {nChars = 11490, line = 260, col = 7}, position = Pos {nChars = 11501, line = 260, col = 18}})) "char.escape" []]),(Fwd (Range {anchor = Pos {nChars = 11538, line = 263, col = 3}, position = Pos {nChars = 11585, line = 265, col = 18}}),(Fwd (Range {anchor = Pos {nChars = 11538, line = 263, col = 3}, position = Pos {nChars = 11546, line = 263, col = 11}}),"chars.dq",[]),Alt (Fwd (Range {anchor = Pos {nChars = 11553, line = 264, col = 7}, position = Pos {nChars = 11585, line = 265, col = 18}})) [Flat (Fwd (Range {anchor = Pos {nChars = 11553, line = 264, col = 7}, position = Pos {nChars = 11567, line = 264, col = 21}})) (Rep (Fwd (Range {anchor = Pos {nChars = 11554, line = 264, col = 8}, position = Pos {nChars = 11566, line = 264, col = 20}})) (Sat (Fwd (Range {anchor = Pos {nChars = 11554, line = 264, col = 8}, position = Pos {nChars = 11565, line = 264, col = 19}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 11555, line = 264, col = 9}, position = Pos {nChars = 11564, line = 264, col = 18}})) "char.dq"]) (1,Nothing)),Call (Fwd (Range {anchor = Pos {nChars = 11574, line = 265, col = 7}, position = Pos {nChars = 11585, line = 265, col = 18}})) "char.escape" []]),(Fwd (Range {anchor = Pos {nChars = 11932, line = 274, col = 3}, position = Pos {nChars = 12266, line = 282, col = 49}}),(Fwd (Range {anchor = Pos {nChars = 11932, line = 274, col = 3}, position = Pos {nChars = 11943, line = 274, col = 14}}),"char.escape",[]),Alt (Fwd (Range {anchor = Pos {nChars = 11950, line = 275, col = 7}, position = Pos {nChars = 12266, line = 282, col = 49}})) [Ctor (Fwd (Range {anchor = Pos {nChars = 11950, line = 275, col = 7}, position = Pos {nChars = 11961, line = 275, col = 18}})) "char-escape" (Flat (Fwd (Range {anchor = Pos {nChars = 11963, line = 275, col = 20}, position = Pos {nChars = 11989, line = 275, col = 46}})) (Seq (Fwd (Range {anchor = Pos {nChars = 11965, line = 275, col = 22}, position = Pos {nChars = 11987, line = 275, col = 44}})) [Char (Fwd (Range {anchor = Pos {nChars = 11965, line = 275, col = 22}, position = Pos {nChars = 11969, line = 275, col = 26}})) '\\',Sat (Fwd (Range {anchor = Pos {nChars = 11970, line = 275, col = 27}, position = Pos {nChars = 11987, line = 275, col = 44}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 11971, line = 275, col = 28}, position = Pos {nChars = 11986, line = 275, col = 43}})) "char.escape.c"]])),Ctor (Fwd (Range {anchor = Pos {nChars = 11996, line = 276, col = 7}, position = Pos {nChars = 12007, line = 276, col = 18}})) "char-escape" (Seq (Fwd (Range {anchor = Pos {nChars = 12009, line = 276, col = 20}, position = Pos {nChars = 12033, line = 276, col = 44}})) [Str (Fwd (Range {anchor = Pos {nChars = 12009, line = 276, col = 20}, position = Pos {nChars = 12014, line = 276, col = 25}})) "\\x",Flat (Fwd (Range {anchor = Pos {nChars = 12015, line = 276, col = 26}, position = Pos {nChars = 12033, line = 276, col = 44}})) (Rep (Fwd (Range {anchor = Pos {nChars = 12016, line = 276, col = 27}, position = Pos {nChars = 12032, line = 276, col = 43}})) (Sat (Fwd (Range {anchor = Pos {nChars = 12016, line = 276, col = 27}, position = Pos {nChars = 12029, line = 276, col = 40}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 12017, line = 276, col = 28}, position = Pos {nChars = 12028, line = 276, col = 39}})) "digit.hex"]) (2,Just 2))]),Ctor (Fwd (Range {anchor = Pos {nChars = 12040, line = 277, col = 7}, position = Pos {nChars = 12051, line = 277, col = 18}})) "char-escape" (Seq (Fwd (Range {anchor = Pos {nChars = 12053, line = 277, col = 20}, position = Pos {nChars = 12077, line = 277, col = 44}})) [Str (Fwd (Range {anchor = Pos {nChars = 12053, line = 277, col = 20}, position = Pos {nChars = 12058, line = 277, col = 25}})) "\\u",Flat (Fwd (Range {anchor = Pos {nChars = 12059, line = 277, col = 26}, position = Pos {nChars = 12077, line = 277, col = 44}})) (Rep (Fwd (Range {anchor = Pos {nChars = 12060, line = 277, col = 27}, position = Pos {nChars = 12076, line = 277, col = 43}})) (Sat (Fwd (Range {anchor = Pos {nChars = 12060, line = 277, col = 27}, position = Pos {nChars = 12073, line = 277, col = 40}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 12061, line = 277, col = 28}, position = Pos {nChars = 12072, line = 277, col = 39}})) "digit.hex"]) (4,Just 4))]),Ctor (Fwd (Range {anchor = Pos {nChars = 12084, line = 278, col = 7}, position = Pos {nChars = 12095, line = 278, col = 18}})) "char-escape" (Seq (Fwd (Range {anchor = Pos {nChars = 12097, line = 278, col = 20}, position = Pos {nChars = 12217, line = 281, col = 24}})) [Str (Fwd (Range {anchor = Pos {nChars = 12097, line = 278, col = 20}, position = Pos {nChars = 12102, line = 278, col = 25}})) "\\U",Flat (Fwd (Range {anchor = Pos {nChars = 12125, line = 279, col = 23}, position = Pos {nChars = 12217, line = 281, col = 24}})) (Alt (Fwd (Range {anchor = Pos {nChars = 12127, line = 279, col = 25}, position = Pos {nChars = 12193, line = 280, col = 46}})) [Seq (Fwd (Range {anchor = Pos {nChars = 12127, line = 279, col = 25}, position = Pos {nChars = 12147, line = 279, col = 45}})) [Char (Fwd (Range {anchor = Pos {nChars = 12127, line = 279, col = 25}, position = Pos {nChars = 12130, line = 279, col = 28}})) '0',Rep (Fwd (Range {anchor = Pos {nChars = 12131, line = 279, col = 29}, position = Pos {nChars = 12147, line = 279, col = 45}})) (Sat (Fwd (Range {anchor = Pos {nChars = 12131, line = 279, col = 29}, position = Pos {nChars = 12144, line = 279, col = 42}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 12132, line = 279, col = 30}, position = Pos {nChars = 12143, line = 279, col = 41}})) "digit.hex"]) (5,Just 5)],Seq (Fwd (Range {anchor = Pos {nChars = 12172, line = 280, col = 25}, position = Pos {nChars = 12193, line = 280, col = 46}})) [Str (Fwd (Range {anchor = Pos {nChars = 12172, line = 280, col = 25}, position = Pos {nChars = 12176, line = 280, col = 29}})) "10",Rep (Fwd (Range {anchor = Pos {nChars = 12177, line = 280, col = 30}, position = Pos {nChars = 12193, line = 280, col = 46}})) (Sat (Fwd (Range {anchor = Pos {nChars = 12177, line = 280, col = 30}, position = Pos {nChars = 12190, line = 280, col = 43}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 12178, line = 280, col = 31}, position = Pos {nChars = 12189, line = 280, col = 42}})) "digit.hex"]) (4,Just 4)]])]),Ctor (Fwd (Range {anchor = Pos {nChars = 12224, line = 282, col = 7}, position = Pos {nChars = 12235, line = 282, col = 18}})) "char-escape" (Seq (Fwd (Range {anchor = Pos {nChars = 12237, line = 282, col = 20}, position = Pos {nChars = 12266, line = 282, col = 49}})) [Char (Fwd (Range {anchor = Pos {nChars = 12237, line = 282, col = 20}, position = Pos {nChars = 12241, line = 282, col = 24}})) '\\',Sat (Fwd (Range {anchor = Pos {nChars = 12242, line = 282, col = 25}, position = Pos {nChars = 12266, line = 282, col = 49}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 12243, line = 282, col = 26}, position = Pos {nChars = 12265, line = 282, col = 48}})) "char.escape.passthru"]])]),(Fwd (Range {anchor = Pos {nChars = 13027, line = 301, col = 3}, position = Pos {nChars = 13061, line = 301, col = 37}}),(Fwd (Range {anchor = Pos {nChars = 13027, line = 301, col = 3}, position = Pos {nChars = 13036, line = 301, col = 12}}),"Name.rule",[]),Flat (Fwd (Range {anchor = Pos {nChars = 13039, line = 301, col = 15}, position = Pos {nChars = 13061, line = 301, col = 37}})) (Call (Fwd (Range {anchor = Pos {nChars = 13041, line = 301, col = 17}, position = Pos {nChars = 13059, line = 301, col = 35}})) "sep.dot" [Call (Fwd (Range {anchor = Pos {nChars = 13049, line = 301, col = 25}, position = Pos {nChars = 13058, line = 301, col = 34}})) "Name.part" []])),(Fwd (Range {anchor = Pos {nChars = 13066, line = 303, col = 3}, position = Pos {nChars = 13088, line = 303, col = 25}}),(Fwd (Range {anchor = Pos {nChars = 13066, line = 303, col = 3}, position = Pos {nChars = 13076, line = 303, col = 13}}),"Name.param",[]),Call (Fwd (Range {anchor = Pos {nChars = 13079, line = 303, col = 16}, position = Pos {nChars = 13088, line = 303, col = 25}})) "Name.part" []),(Fwd (Range {anchor = Pos {nChars = 13093, line = 305, col = 3}, position = Pos {nChars = 13115, line = 305, col = 25}}),(Fwd (Range {anchor = Pos {nChars = 13093, line = 305, col = 3}, position = Pos {nChars = 13103, line = 305, col = 13}}),"Name.class",[]),Call (Fwd (Range {anchor = Pos {nChars = 13106, line = 305, col = 16}, position = Pos {nChars = 13115, line = 305, col = 25}})) "Name.rule" []),(Fwd (Range {anchor = Pos {nChars = 13189, line = 308, col = 3}, position = Pos {nChars = 13224, line = 308, col = 38}}),(Fwd (Range {anchor = Pos {nChars = 13189, line = 308, col = 3}, position = Pos {nChars = 13198, line = 308, col = 12}}),"Name.ctor",[]),Flat (Fwd (Range {anchor = Pos {nChars = 13201, line = 308, col = 15}, position = Pos {nChars = 13224, line = 308, col = 38}})) (Call (Fwd (Range {anchor = Pos {nChars = 13203, line = 308, col = 17}, position = Pos {nChars = 13222, line = 308, col = 36}})) "sep.dash" [Call (Fwd (Range {anchor = Pos {nChars = 13212, line = 308, col = 26}, position = Pos {nChars = 13221, line = 308, col = 35}})) "Name.part" []])),(Fwd (Range {anchor = Pos {nChars = 13229, line = 310, col = 3}, position = Pos {nChars = 13289, line = 310, col = 63}}),(Fwd (Range {anchor = Pos {nChars = 13229, line = 310, col = 3}, position = Pos {nChars = 13238, line = 310, col = 12}}),"Name.part",[]),Flat (Fwd (Range {anchor = Pos {nChars = 13241, line = 310, col = 15}, position = Pos {nChars = 13289, line = 310, col = 63}})) (Seq (Fwd (Range {anchor = Pos {nChars = 13243, line = 310, col = 17}, position = Pos {nChars = 13287, line = 310, col = 61}})) [Sat (Fwd (Range {anchor = Pos {nChars = 13243, line = 310, col = 17}, position = Pos {nChars = 13262, line = 310, col = 36}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 13244, line = 310, col = 18}, position = Pos {nChars = 13257, line = 310, col = 31}})) "ascii.alpha",SatChar (Fwd (Range {anchor = Pos {nChars = 13258, line = 310, col = 32}, position = Pos {nChars = 13261, line = 310, col = 35}})) '_'],Rep (Fwd (Range {anchor = Pos {nChars = 13263, line = 310, col = 37}, position = Pos {nChars = 13287, line = 310, col = 61}})) (Sat (Fwd (Range {anchor = Pos {nChars = 13263, line = 310, col = 37}, position = Pos {nChars = 13286, line = 310, col = 60}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 13264, line = 310, col = 38}, position = Pos {nChars = 13281, line = 310, col = 55}})) "ascii.alpha_num",SatChar (Fwd (Range {anchor = Pos {nChars = 13282, line = 310, col = 56}, position = Pos {nChars = 13285, line = 310, col = 59}})) '_']) (0,Nothing)])),(Fwd (Range {anchor = Pos {nChars = 13809, line = 329, col = 3}, position = Pos {nChars = 13843, line = 329, col = 37}}),(Fwd (Range {anchor = Pos {nChars = 13809, line = 329, col = 3}, position = Pos {nChars = 13816, line = 329, col = 10}}),"num.nat",[]),Flat (Fwd (Range {anchor = Pos {nChars = 13819, line = 329, col = 13}, position = Pos {nChars = 13843, line = 329, col = 37}})) (Seq (Fwd (Range {anchor = Pos {nChars = 13821, line = 329, col = 15}, position = Pos {nChars = 13841, line = 329, col = 35}})) [Sat (Fwd (Range {anchor = Pos {nChars = 13821, line = 329, col = 15}, position = Pos {nChars = 13830, line = 329, col = 24}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 13822, line = 329, col = 16}, position = Pos {nChars = 13829, line = 329, col = 23}})) "digit"],Rep (Fwd (Range {anchor = Pos {nChars = 13831, line = 329, col = 25}, position = Pos {nChars = 13841, line = 329, col = 35}})) (Sat (Fwd (Range {anchor = Pos {nChars = 13831, line = 329, col = 25}, position = Pos {nChars = 13840, line = 329, col = 34}})) [SatVar (Fwd (Range {anchor = Pos {nChars = 13832, line = 329, col = 26}, position = Pos {nChars = 13839, line = 329, col = 33}})) "digit"]) (0,Nothing)])),(Fwd (Range {anchor = Pos {nChars = 14044, line = 336, col = 3}, position = Pos {nChars = 14076, line = 336, col = 35}}),(Fwd (Range {anchor = Pos {nChars = 14044, line = 336, col = 3}, position = Pos {nChars = 14058, line = 336, col = 17}}),"enclose",["o","i","c"]),Seq (Fwd (Range {anchor = Pos {nChars = 14061, line = 336, col = 20}, position = Pos {nChars = 14076, line = 336, col = 35}})) [Call (Fwd (Range {anchor = Pos {nChars = 14061, line = 336, col = 20}, position = Pos {nChars = 14062, line = 336, col = 21}})) "o" [],Rep (Fwd (Range {anchor = Pos {nChars = 14063, line = 336, col = 22}, position = Pos {nChars = 14067, line = 336, col = 26}})) (Call (Fwd (Range {anchor = Pos {nChars = 14063, line = 336, col = 22}, position = Pos {nChars = 14066, line = 336, col = 25}})) "lws" []) (0,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 14068, line = 336, col = 27}, position = Pos {nChars = 14069, line = 336, col = 28}})) "i" [],Rep (Fwd (Range {anchor = Pos {nChars = 14070, line = 336, col = 29}, position = Pos {nChars = 14074, line = 336, col = 33}})) (Call (Fwd (Range {anchor = Pos {nChars = 14070, line = 336, col = 29}, position = Pos {nChars = 14073, line = 336, col = 32}})) "lws" []) (0,Nothing),Call (Fwd (Range {anchor = Pos {nChars = 14075, line = 336, col = 34}, position = Pos {nChars = 14076, line = 336, col = 35}})) "c" []]),(Fwd (Range {anchor = Pos {nChars = 14081, line = 338, col = 3}, position = Pos {nChars = 14119, line = 338, col = 41}}),(Fwd (Range {anchor = Pos {nChars = 14081, line = 338, col = 3}, position = Pos {nChars = 14098, line = 338, col = 20}}),"enclose.parens",["i"]),Call (Fwd (Range {anchor = Pos {nChars = 14101, line = 338, col = 23}, position = Pos {nChars = 14119, line = 338, col = 41}})) "enclose" [Char (Fwd (Range {anchor = Pos {nChars = 14109, line = 338, col = 31}, position = Pos {nChars = 14112, line = 338, col = 34}})) '(',Call (Fwd (Range {anchor = Pos {nChars = 14113, line = 338, col = 35}, position = Pos {nChars = 14114, line = 338, col = 36}})) "i" [],Char (Fwd (Range {anchor = Pos {nChars = 14115, line = 338, col = 37}, position = Pos {nChars = 14118, line = 338, col = 40}})) ')']),(Fwd (Range {anchor = Pos {nChars = 14122, line = 339, col = 3}, position = Pos {nChars = 14160, line = 339, col = 41}}),(Fwd (Range {anchor = Pos {nChars = 14122, line = 339, col = 3}, position = Pos {nChars = 14139, line = 339, col = 20}}),"enclose.braces",["i"]),Call (Fwd (Range {anchor = Pos {nChars = 14142, line = 339, col = 23}, position = Pos {nChars = 14160, line = 339, col = 41}})) "enclose" [Char (Fwd (Range {anchor = Pos {nChars = 14150, line = 339, col = 31}, position = Pos {nChars = 14153, line = 339, col = 34}})) '{',Call (Fwd (Range {anchor = Pos {nChars = 14154, line = 339, col = 35}, position = Pos {nChars = 14155, line = 339, col = 36}})) "i" [],Char (Fwd (Range {anchor = Pos {nChars = 14156, line = 339, col = 37}, position = Pos {nChars = 14159, line = 339, col = 40}})) '}']),(Fwd (Range {anchor = Pos {nChars = 14163, line = 340, col = 3}, position = Pos {nChars = 14201, line = 340, col = 41}}),(Fwd (Range {anchor = Pos {nChars = 14163, line = 340, col = 3}, position = Pos {nChars = 14180, line = 340, col = 20}}),"enclose.angles",["i"]),Call (Fwd (Range {anchor = Pos {nChars = 14183, line = 340, col = 23}, position = Pos {nChars = 14201, line = 340, col = 41}})) "enclose" [Char (Fwd (Range {anchor = Pos {nChars = 14191, line = 340, col = 31}, position = Pos {nChars = 14194, line = 340, col = 34}})) '<',Call (Fwd (Range {anchor = Pos {nChars = 14195, line = 340, col = 35}, position = Pos {nChars = 14196, line = 340, col = 36}})) "i" [],Char (Fwd (Range {anchor = Pos {nChars = 14197, line = 340, col = 37}, position = Pos {nChars = 14200, line = 340, col = 40}})) '>']),(Fwd (Range {anchor = Pos {nChars = 14204, line = 341, col = 3}, position = Pos {nChars = 14241, line = 341, col = 40}}),(Fwd (Range {anchor = Pos {nChars = 14204, line = 341, col = 3}, position = Pos {nChars = 14220, line = 341, col = 19}}),"enclose.colon",["i"]),Call (Fwd (Range {anchor = Pos {nChars = 14223, line = 341, col = 22}, position = Pos {nChars = 14241, line = 341, col = 40}})) "enclose" [Char (Fwd (Range {anchor = Pos {nChars = 14231, line = 341, col = 30}, position = Pos {nChars = 14234, line = 341, col = 33}})) ':',Call (Fwd (Range {anchor = Pos {nChars = 14235, line = 341, col = 34}, position = Pos {nChars = 14236, line = 341, col = 35}})) "i" [],Char (Fwd (Range {anchor = Pos {nChars = 14237, line = 341, col = 36}, position = Pos {nChars = 14240, line = 341, col = 39}})) ':']),(Fwd (Range {anchor = Pos {nChars = 14245, line = 343, col = 3}, position = Pos {nChars = 14267, line = 343, col = 25}}),(Fwd (Range {anchor = Pos {nChars = 14245, line = 343, col = 3}, position = Pos {nChars = 14256, line = 343, col = 14}}),"sep.by",["e","s"]),Seq (Fwd (Range {anchor = Pos {nChars = 14259, line = 343, col = 17}, position = Pos {nChars = 14267, line = 343, col = 25}})) [Call (Fwd (Range {anchor = Pos {nChars = 14259, line = 343, col = 17}, position = Pos {nChars = 14260, line = 343, col = 18}})) "e" [],Rep (Fwd (Range {anchor = Pos {nChars = 14261, line = 343, col = 19}, position = Pos {nChars = 14267, line = 343, col = 25}})) (Seq (Fwd (Range {anchor = Pos {nChars = 14262, line = 343, col = 20}, position = Pos {nChars = 14265, line = 343, col = 23}})) [Call (Fwd (Range {anchor = Pos {nChars = 14262, line = 343, col = 20}, position = Pos {nChars = 14263, line = 343, col = 21}})) "s" [],Call (Fwd (Range {anchor = Pos {nChars = 14264, line = 343, col = 22}, position = Pos {nChars = 14265, line = 343, col = 23}})) "e" []]) (0,Nothing)]),(Fwd (Range {anchor = Pos {nChars = 14272, line = 345, col = 3}, position = Pos {nChars = 14302, line = 345, col = 33}}),(Fwd (Range {anchor = Pos {nChars = 14272, line = 345, col = 3}, position = Pos {nChars = 14284, line = 345, col = 15}}),"sep.comma",["e"]),Call (Fwd (Range {anchor = Pos {nChars = 14287, line = 345, col = 18}, position = Pos {nChars = 14302, line = 345, col = 33}})) "sep.by" [Call (Fwd (Range {anchor = Pos {nChars = 14294, line = 345, col = 25}, position = Pos {nChars = 14295, line = 345, col = 26}})) "e" [],Call (Fwd (Range {anchor = Pos {nChars = 14296, line = 345, col = 27}, position = Pos {nChars = 14301, line = 345, col = 32}})) "comma" []]),(Fwd (Range {anchor = Pos {nChars = 14305, line = 346, col = 3}, position = Pos {nChars = 14331, line = 346, col = 29}}),(Fwd (Range {anchor = Pos {nChars = 14305, line = 346, col = 3}, position = Pos {nChars = 14315, line = 346, col = 13}}),"sep.dot",["e"]),Call (Fwd (Range {anchor = Pos {nChars = 14318, line = 346, col = 16}, position = Pos {nChars = 14331, line = 346, col = 29}})) "sep.by" [Call (Fwd (Range {anchor = Pos {nChars = 14325, line = 346, col = 23}, position = Pos {nChars = 14326, line = 346, col = 24}})) "e" [],Char (Fwd (Range {anchor = Pos {nChars = 14327, line = 346, col = 25}, position = Pos {nChars = 14330, line = 346, col = 28}})) '.']),(Fwd (Range {anchor = Pos {nChars = 14334, line = 347, col = 3}, position = Pos {nChars = 14361, line = 347, col = 30}}),(Fwd (Range {anchor = Pos {nChars = 14334, line = 347, col = 3}, position = Pos {nChars = 14345, line = 347, col = 14}}),"sep.dash",["e"]),Call (Fwd (Range {anchor = Pos {nChars = 14348, line = 347, col = 17}, position = Pos {nChars = 14361, line = 347, col = 30}})) "sep.by" [Call (Fwd (Range {anchor = Pos {nChars = 14355, line = 347, col = 24}, position = Pos {nChars = 14356, line = 347, col = 25}})) "e" [],Char (Fwd (Range {anchor = Pos {nChars = 14357, line = 347, col = 26}, position = Pos {nChars = 14360, line = 347, col = 29}})) '-']),(Fwd (Range {anchor = Pos {nChars = 14365, line = 349, col = 3}, position = Pos {nChars = 14386, line = 349, col = 24}}),(Fwd (Range {anchor = Pos {nChars = 14365, line = 349, col = 3}, position = Pos {nChars = 14370, line = 349, col = 8}}),"comma",[]),Seq (Fwd (Range {anchor = Pos {nChars = 14373, line = 349, col = 11}, position = Pos {nChars = 14386, line = 349, col = 24}})) [Rep (Fwd (Range {anchor = Pos {nChars = 14373, line = 349, col = 11}, position = Pos {nChars = 14377, line = 349, col = 15}})) (Call (Fwd (Range {anchor = Pos {nChars = 14373, line = 349, col = 11}, position = Pos {nChars = 14376, line = 349, col = 14}})) "lws" []) (0,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 14378, line = 349, col = 16}, position = Pos {nChars = 14381, line = 349, col = 19}})) ',',Rep (Fwd (Range {anchor = Pos {nChars = 14382, line = 349, col = 20}, position = Pos {nChars = 14386, line = 349, col = 24}})) (Call (Fwd (Range {anchor = Pos {nChars = 14382, line = 349, col = 20}, position = Pos {nChars = 14385, line = 349, col = 23}})) "lws" []) (0,Nothing)]),(Fwd (Range {anchor = Pos {nChars = 14389, line = 350, col = 3}, position = Pos {nChars = 14410, line = 350, col = 24}}),(Fwd (Range {anchor = Pos {nChars = 14389, line = 350, col = 3}, position = Pos {nChars = 14394, line = 350, col = 8}}),"colon",[]),Seq (Fwd (Range {anchor = Pos {nChars = 14397, line = 350, col = 11}, position = Pos {nChars = 14410, line = 350, col = 24}})) [Rep (Fwd (Range {anchor = Pos {nChars = 14397, line = 350, col = 11}, position = Pos {nChars = 14401, line = 350, col = 15}})) (Call (Fwd (Range {anchor = Pos {nChars = 14397, line = 350, col = 11}, position = Pos {nChars = 14400, line = 350, col = 14}})) "lws" []) (0,Nothing),Char (Fwd (Range {anchor = Pos {nChars = 14402, line = 350, col = 16}, position = Pos {nChars = 14405, line = 350, col = 19}})) ':',Rep (Fwd (Range {anchor = Pos {nChars = 14406, line = 350, col = 20}, position = Pos {nChars = 14410, line = 350, col = 24}})) (Call (Fwd (Range {anchor = Pos {nChars = 14406, line = 350, col = 20}, position = Pos {nChars = 14409, line = 350, col = 23}})) "lws" []) (1,Nothing)])], classes = [(Fwd (Range {anchor = Pos {nChars = 11504, line = 261, col = 3}, position = Pos {nChars = 11533, line = 261, col = 32}}),(Fwd (Range {anchor = Pos {nChars = 11505, line = 261, col = 4}, position = Pos {nChars = 11512, line = 261, col = 11}}),"char.sq"),ClassMinus (ClassRange (Fwd (Range {anchor = Pos {nChars = 11516, line = 261, col = 15}, position = Pos {nChars = 11524, line = 261, col = 23}})) ' ' '~') (ClassSet (Fwd (Range {anchor = Pos {nChars = 11527, line = 261, col = 26}, position = Pos {nChars = 11533, line = 261, col = 32}})) "'\\")),(Fwd (Range {anchor = Pos {nChars = 11588, line = 266, col = 3}, position = Pos {nChars = 11617, line = 266, col = 32}}),(Fwd (Range {anchor = Pos {nChars = 11589, line = 266, col = 4}, position = Pos {nChars = 11596, line = 266, col = 11}}),"char.dq"),ClassMinus (ClassRange (Fwd (Range {anchor = Pos {nChars = 11600, line = 266, col = 15}, position = Pos {nChars = 11608, line = 266, col = 23}})) ' ' '~') (ClassSet (Fwd (Range {anchor = Pos {nChars = 11611, line = 266, col = 26}, position = Pos {nChars = 11617, line = 266, col = 32}})) "\"\\")),(Fwd (Range {anchor = Pos {nChars = 12269, line = 283, col = 3}, position = Pos {nChars = 12298, line = 283, col = 32}}),(Fwd (Range {anchor = Pos {nChars = 12270, line = 283, col = 4}, position = Pos {nChars = 12283, line = 283, col = 17}}),"char.escape.c"),ClassSet (Fwd (Range {anchor = Pos {nChars = 12287, line = 283, col = 21}, position = Pos {nChars = 12298, line = 283, col = 32}})) "0abefnrtv"),(Fwd (Range {anchor = Pos {nChars = 12301, line = 284, col = 3}, position = Pos {nChars = 12365, line = 284, col = 67}}),(Fwd (Range {anchor = Pos {nChars = 12302, line = 284, col = 4}, position = Pos {nChars = 12322, line = 284, col = 24}}),"char.escape.passthru"),ClassMinus (ClassMinus (ClassVar (Fwd (Range {anchor = Pos {nChars = 12326, line = 284, col = 28}, position = Pos {nChars = 12339, line = 284, col = 41}})) "ascii.print") (ClassVar (Fwd (Range {anchor = Pos {nChars = 12342, line = 284, col = 44}, position = Pos {nChars = 12357, line = 284, col = 59}})) "char.escape.c")) (ClassSet (Fwd (Range {anchor = Pos {nChars = 12360, line = 284, col = 62}, position = Pos {nChars = 12365, line = 284, col = 67}})) "xuU")),(Fwd (Range {anchor = Pos {nChars = 12764, line = 293, col = 3}, position = Pos {nChars = 12808, line = 293, col = 47}}),(Fwd (Range {anchor = Pos {nChars = 12765, line = 293, col = 4}, position = Pos {nChars = 12775, line = 293, col = 14}}),"char.brack"),ClassMinus (ClassVar (Fwd (Range {anchor = Pos {nChars = 12779, line = 293, col = 18}, position = Pos {nChars = 12792, line = 293, col = 31}})) "ascii.print") (ClassSet (Fwd (Range {anchor = Pos {nChars = 12795, line = 293, col = 34}, position = Pos {nChars = 12808, line = 293, col = 47}})) " []'\"-:\\")),(Fwd (Range {anchor = Pos {nChars = 13464, line = 317, col = 3}, position = Pos {nChars = 13488, line = 317, col = 27}}),(Fwd (Range {anchor = Pos {nChars = 13465, line = 317, col = 4}, position = Pos {nChars = 13476, line = 317, col = 15}}),"ascii.print"),ClassRange (Fwd (Range {anchor = Pos {nChars = 13480, line = 317, col = 19}, position = Pos {nChars = 13488, line = 317, col = 27}})) ' ' '~'),(Fwd (Range {anchor = Pos {nChars = 13492, line = 319, col = 3}, position = Pos {nChars = 13510, line = 319, col = 21}}),(Fwd (Range {anchor = Pos {nChars = 13493, line = 319, col = 4}, position = Pos {nChars = 13498, line = 319, col = 9}}),"digit"),ClassRange (Fwd (Range {anchor = Pos {nChars = 13502, line = 319, col = 13}, position = Pos {nChars = 13510, line = 319, col = 21}})) '0' '9'),(Fwd (Range {anchor = Pos {nChars = 13513, line = 320, col = 3}, position = Pos {nChars = 13556, line = 320, col = 46}}),(Fwd (Range {anchor = Pos {nChars = 13514, line = 320, col = 4}, position = Pos {nChars = 13523, line = 320, col = 13}}),"digit.hex"),ClassUnion (ClassUnion (ClassVar (Fwd (Range {anchor = Pos {nChars = 13527, line = 320, col = 17}, position = Pos {nChars = 13534, line = 320, col = 24}})) "digit") (ClassRange (Fwd (Range {anchor = Pos {nChars = 13537, line = 320, col = 27}, position = Pos {nChars = 13545, line = 320, col = 35}})) 'a' 'f')) (ClassRange (Fwd (Range {anchor = Pos {nChars = 13548, line = 320, col = 38}, position = Pos {nChars = 13556, line = 320, col = 46}})) 'A' 'F')),(Fwd (Range {anchor = Pos {nChars = 13560, line = 322, col = 3}, position = Pos {nChars = 13611, line = 322, col = 54}}),(Fwd (Range {anchor = Pos {nChars = 13561, line = 322, col = 4}, position = Pos {nChars = 13572, line = 322, col = 15}}),"ascii.alpha"),ClassUnion (ClassVar (Fwd (Range {anchor = Pos {nChars = 13576, line = 322, col = 19}, position = Pos {nChars = 13592, line = 322, col = 35}})) "ascii.alpha.lo") (ClassVar (Fwd (Range {anchor = Pos {nChars = 13595, line = 322, col = 38}, position = Pos {nChars = 13611, line = 322, col = 54}})) "ascii.alpha.hi")),(Fwd (Range {anchor = Pos {nChars = 13614, line = 323, col = 3}, position = Pos {nChars = 13641, line = 323, col = 30}}),(Fwd (Range {anchor = Pos {nChars = 13615, line = 323, col = 4}, position = Pos {nChars = 13629, line = 323, col = 18}}),"ascii.alpha.lo"),ClassRange (Fwd (Range {anchor = Pos {nChars = 13633, line = 323, col = 22}, position = Pos {nChars = 13641, line = 323, col = 30}})) 'a' 'z'),(Fwd (Range {anchor = Pos {nChars = 13644, line = 324, col = 3}, position = Pos {nChars = 13671, line = 324, col = 30}}),(Fwd (Range {anchor = Pos {nChars = 13645, line = 324, col = 4}, position = Pos {nChars = 13659, line = 324, col = 18}}),"ascii.alpha.hi"),ClassRange (Fwd (Range {anchor = Pos {nChars = 13663, line = 324, col = 22}, position = Pos {nChars = 13671, line = 324, col = 30}})) 'A' 'Z'),(Fwd (Range {anchor = Pos {nChars = 13674, line = 325, col = 3}, position = Pos {nChars = 13717, line = 325, col = 46}}),(Fwd (Range {anchor = Pos {nChars = 13675, line = 325, col = 4}, position = Pos {nChars = 13690, line = 325, col = 19}}),"ascii.alpha_num"),ClassUnion (ClassVar (Fwd (Range {anchor = Pos {nChars = 13694, line = 325, col = 23}, position = Pos {nChars = 13707, line = 325, col = 36}})) "ascii.alpha") (ClassVar (Fwd (Range {anchor = Pos {nChars = 13710, line = 325, col = 39}, position = Pos {nChars = 13717, line = 325, col = 46}})) "digit"))]}

------ Cleanup ------

pattern Kw :: Text -> Texpr
pattern Kw str <- Atom _ str

-- | Eliminates unnecessary nodes (whitespace, keywords, &c) from a TBNF parse
-- tree.
clean :: Texprs -> Texprs
clean ts = cleanKeywords <$> concatMap cleanSpace ts

cleanSpace :: Texpr -> Texprs
cleanSpace t@(Atom _ _) = [t]
cleanSpace (Combo l name ts)
  | name `elem` ["space", "nl", "comment", "doc", "bird-foot"] = []
  | otherwise = [Combo l name (concatMap cleanSpace ts)]

cleanKeywords :: Texpr -> Texpr
cleanKeywords t@(Atom _ _) = t
cleanKeywords (Combo l "rule-sat" ((cleanKeywords <$>) -> ts))
  | (Kw "[^" : (unsnoc -> Just (ts', Kw "]"))) <- ts
  = Combo l "rule-sat-neg" ts'
cleanKeywords (Combo l ctor ((cleanKeywords <$>) -> ts0)) = Combo l ctor (go ctor ts0)
  where
  go "class-char" [Kw "\'", c, Kw "\'"] = [c]
  go "class-range" [Kw "\'", lo, Kw "\'", Kw "..", Kw "\'", hi, Kw "\'"] = [lo, hi]
  go "class-set" (Kw "\"" : (unsnoc -> Just (ts, Kw "\""))) = ts
  go "class-var" [Kw ":", name, Kw ":"] = [name]
  go "def-class" (Kw ":":name:Kw ":":Kw "=":body) = (name : body)
  go "def-rule" (name : Kw "=" : rest) = name : rest
  go "rep-custom" (Kw "{" : (unsnoc -> Just (ts, Kw "}"))) = ts
  go "rep-custom" [Kw "{", comma@(Kw ","), hi, Kw "}"] = [comma, hi]
  go "rep-custom" [Kw "{", lo, comma@(Kw ","), hi, Kw "}"] = [lo, comma, hi]
  go "rep-custom" [Kw "{", lo, comma@(Kw ","), Kw "}"] = [lo, comma]
  go "rule-call" (f : Kw "<" : (unsnoc -> Just (ts, Kw ">"))) = f : concatMap cleanComma ts
  go "rule-capture" [Kw "@", name, Kw "=", capture, scope] = [name, capture, scope]
  go "rule-char" [Kw "\'", c, Kw "\'"] = [c]
  go "rule-combo" [Kw "{", name , Kw "}"] = [name]
  go "rule-commit" [Kw "(", t1, Kw "->", t2, Kw ")"] = [t1, t2]
  go "rule-ctor" (name : Kw ":" : rest) = name:rest
  go "rule-end" [Kw "$"] = []
  go "rule-expect" (rule : Kw "??" : Kw "\"" : (unsnoc -> Just (msg, Kw "\""))) = (rule : msg)
  go "rule-flat" (Kw "/" : (unsnoc -> Just (ts, Kw "/"))) = ts
  go "rule-group" (Kw "(" : (unsnoc -> Just (ts, Kw ")"))) = ts
  go "rule-parametric" (f : Kw "<" : (unsnoc -> Just (ts, Kw ">"))) = f : concatMap cleanComma ts
  go "rule-sat" (Kw "[" : (unsnoc -> Just (ts, Kw "]"))) = ts
  go "rule-string" (Kw "\"" : (unsnoc -> Just (ts, Kw "\""))) = ts
  go "rule-void" (Kw "0" : Kw ":" : Kw "\"" : (unsnoc -> Just (ts, Kw "\""))) = ts
  go "sat-char" [Kw "\'", c, Kw "\'"] = [c]
  go "sat-range" [Kw "\'", lo, Kw "\'", Kw "..", Kw "\'", hi, Kw "\'"] = [lo, hi]
  go "sat-var" [Kw ":", name, Kw ":"] = [name]
  go _ other = other

cleanComma :: Texpr -> Texprs
cleanComma (Kw ",") = []
cleanComma t = [t]

unsnoc :: [a] -> Maybe ([a], a)
unsnoc xs = do
  (x,xs') <- uncons (reverse xs)
  pure (reverse xs', x)

-- | Translate the given the ('clean'ed) parse tree of a TBNF grammar
-- into an abstract syntax tree.
parseTbnf :: Texprs -> Tbnf
parseTbnf ts0 =
  let (classes, ts1) = parseClasses ts0
      (rules, ts2) = parseRules ts1
      start = parseStartDef ts2
   in Tbnf {start, rules, classes}

------ Start ------

type StartDef = Maybe (FwdRange, RuleName)

parseStartDef :: Texprs -> StartDef
parseStartDef [] = Nothing
parseStartDef [t] = Just $ go t
  where
  go (Combo l "def-start" [Atom _ name]) = (l, fromString $ T.unpack name)
  go _ = error "internal Tbnf grammar error"
parseStartDef _ = error "internal Tbnf grammar error"

------ Rules ------

type RuleDef = (FwdRange, (FwdRange, RuleName, [ParamName]), Rule)

parseRules :: Texprs -> ([RuleDef], Texprs)
parseRules defs =
  let (rs, defs') = partition isRuleDef defs
      rs' = parseRuleDef <$> rs
   in (rs', defs')
  where
  isRuleDef (Combo _ "def-rule" _) = True
  isRuleDef _ = False

parseRuleDef :: Texpr -> RuleDef
parseRuleDef (Combo l "def-rule" [binder,body]) = (l, parseRuleBinder binder, parseRule body)
parseRuleDef _ = error "internal Tbnf grammar error"

parseRuleBinder :: Texpr -> (FwdRange, RuleName, [ParamName])
parseRuleBinder (Atom l str) = (l, fromString $ T.unpack str, [])
parseRuleBinder (Combo l "rule-parametric" (f:params)) =
  (l, fromName f, fromName <$> params)
  where
  fromName (Atom _ str) = fromString $ T.unpack str
  fromName _  = error "internal Tbnf grammar error"
parseRuleBinder _ = error "internal Tbnf grammar error"

parseRule :: Texpr -> Rule
parseRule (Combo l "rule-alt" ts) = Alt l $ loop ts
  where
  loop [t] = [parseRule t]
  loop (a:Kw "|":rest) = parseRule a : loop rest
  loop _ = error "internal Tbnf grammar error"
parseRule (Combo l "rule-call" (Atom _ f : args)) = Call l (fromString $ T.unpack f) (parseRule <$> args)
parseRule (Combo l "rule-capture" [(Atom _ name), capture, scope])
    = Cap l (fromString $ T.unpack name) (parseRule capture) (parseRule scope)
parseRule (Combo l "rule-char" [c]) = Char l $ parseChar c
parseRule (Combo _ "rule-combo" [Atom l ctor]) = TexprCombo l (fromString $ T.unpack ctor)
parseRule (Combo _ "rule-ctor" [Atom l ctor, g]) = Ctor l (fromString $ T.unpack ctor) $ parseRule g
parseRule (Combo l "rule-end" []) = End l
parseRule (Combo l "rule-expect" (g : msg)) = Expect l (parseRule g) (T.pack $ concatMap parseStr msg)
parseRule (Combo l "rule-flat" [g]) = Flat l $ parseRule g
parseRule (Combo _ "rule-group" [g]) = parseRule g
parseRule (Combo l "rule-rep" [g, amt]) = Rep l (parseRule g) (parseAmount amt)
  where
  parseAmount :: Texpr -> (Int, Maybe Int)
  parseAmount (Kw "*") = (0, Nothing)
  parseAmount (Kw "+") = (1, Nothing)
  parseAmount (Kw "?") = (0, Just 1)
  parseAmount (Combo _ "rep-custom" [Kw ","]) = (0, Nothing)
  parseAmount (Combo _ "rep-custom" [t]) = (parseInt t, Just $ parseInt t)
  parseAmount (Combo _ "rep-custom" [t,Kw ","]) = (parseInt t, Nothing)
  parseAmount (Combo _ "rep-custom" [Kw ",", t]) = (0, Just $ parseInt t)
  parseAmount (Combo _ "rep-custom" [t1, Kw ",", t2]) = (parseInt t1, Just $ parseInt t2)
  parseAmount _ = error "internal Tbnf grammar error"
  parseInt :: Texpr -> Int
  parseInt (Atom _ n) = read (T.unpack n)
  parseInt _ = error "internal Tbnf grammar error"
parseRule (Combo l "rule-sat" ts) = Sat l $ parseSatClass <$> ts
parseRule (Combo l "rule-sat-neg" ts) = SatNeg l $ parseSatClass <$> ts
parseRule (Combo l "rule-seq" ts) = Seq l $ parseRule <$> ts
parseRule (Combo l "rule-string" ts) = Str l (T.pack $ concatMap parseStr ts)
parseRule (Combo l "rule-void" [Atom _ msg]) = Void l msg
parseRule _ = error "internal Tbnf grammar error"

parseSatClass :: Texpr -> SatClass
parseSatClass = \case
  Combo l "sat-char" [c] -> SatChar l (parseChar c)
  Combo l "sat-range" [lo, hi] -> SatRange l (parseChar lo) (parseChar hi)
  Combo l "sat-var" [Atom _ name] -> SatVar l (fromString $ T.unpack name)
  Atom l cs -> SatSet l (T.unpack cs)
  _ -> error "internal Tbnf grammar error"

------ Character Classes ------

type ClassDef = (FwdRange, (FwdRange, RuleName), CharClass)

parseClasses :: Texprs -> ([ClassDef], Texprs)
parseClasses defs =
  let (clss, defs') = partition isClassDef defs
      clss' = parseClass <$> clss
   in (clss', defs')
  where
  isClassDef (Combo _ "def-class" _) = True
  isClassDef _ = False

parseClass :: Texpr -> (FwdRange, (FwdRange, RuleName), CharClass)
parseClass (Combo l "def-class" (Atom xLoc (T.unpack -> x) : body)) =
  (l, (xLoc, fromString x), parseClassBody body)
parseClass _ = error "internal Tbnf grammar error"

parseClassBody :: Texprs -> CharClass
parseClassBody = loop . reverse
  where
  loop = \case
    [t] -> parseClassTerm t
    (b:o:prior) -> (parseOper o) (loop prior) (parseClassTerm b)
    _ -> error "internal Tbnf grammar error"
  parseOper (Kw "|") = ClassUnion
  parseOper (Kw "-") = ClassMinus
  parseOper _ = error "internal Tbnf grammar error"

parseClassTerm :: Texpr -> CharClass
parseClassTerm t = case t of
  Combo l "class-var" [Atom _ (T.unpack -> name)] -> ClassVar l (fromString name)
  Combo l "class-char" [c] -> ClassChar l (parseChar c)
  Combo l "class-range" [lo, hi] -> ClassRange l (parseChar lo) (parseChar hi)
  Combo l "class-set" elems -> ClassSet l (concatMap parseStr elems)
  _ -> error "internal Tbnf grammar error"

------ Utility Parsers ------

parseChar :: Texpr -> Char
parseChar (Atom _ (T.unpack -> [c])) = c
parseChar (Combo _ "char-escape" [Atom _ (T.unpack -> ['\\',c])]) = case c of
  '0' -> '\NUL'
  'a' -> '\a'
  'b' -> '\b'
  'e' -> '\ESC'
  'f' -> '\f'
  'n' -> '\n'
  'r' -> '\r'
  't' -> '\t'
  'v' -> '\v'
  _ -> error "internal Tbnf grammar error"
parseChar (Combo _ "char-escape" [Atom _ kw, Atom _ (T.unpack -> str)]) = case kw of
  "\\x" -> chr $ read ("0x" ++ str)
  "\\u" -> chr $ read ("0x" ++ str)
  "\\U" -> chr $ read ("0x" ++ str)
  "\\" -> head str
  _ -> error "internal Tbnf grammar error"
parseChar t = error $ "internal Tbnf grammar error: parseChar " ++ show t

parseStr :: Texpr -> String
parseStr (Atom _ str) = T.unpack str
parseStr t@(Combo _ "char-escape" _) = [parseChar t]
parseStr _ = error "internal Tbnf grammar error"
